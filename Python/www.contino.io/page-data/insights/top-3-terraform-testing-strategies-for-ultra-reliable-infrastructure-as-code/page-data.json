{"componentChunkName":"component---src-templates-article-js","path":"/insights/top-3-terraform-testing-strategies-for-ultra-reliable-infrastructure-as-code","result":{"data":{"sanityArticle":{"publishedAt":"3 July 2017","publishedAtRaw":"2017-07-03","title":"Top 3 Terraform Testing Strategies for Ultra-Reliable Infrastructure-as-Code","seoTitle":"Top 3 Terraform Testing Strategies for Ultra-Reliable Infrastructure-as-Code","seoDescription":"Self-confessed Terraform-lover Carlos Nunez takes us through examples of unit and integration testing for ultra-reliable infrastructure-as-code.","slug":{"current":"top-3-terraform-testing-strategies-for-ultra-reliable-infrastructure-as-code"},"heroImage":{"alt":"Top 3 Terraform Testing Strategies for Ultra-Reliable Infrastructure-as-Code","asset":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUDBgj/xAAhEAABBAICAgMAAAAAAAAAAAABAAIDBAUSESEGEyJRcf/EABUBAQEAAAAAAAAAAAAAAAAAAAAC/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAECEf/aAAwDAQACEQMRAD8A0HPk82xl5kePa+SAjRwPUn4oB5DmQIwcDOeR8jsFbUKqpU9SwC3GXrVmt7LNF9eTYjRx56+0JkhSD//Z","aspectRatio":1.7777777777777777,"src":"https://cdn.sanity.io/images/hgftikht/production/cb2c44f6ee3262afd0861f53e88a0b3ab2ce4993-1200x675.jpg","srcSet":"https://cdn.sanity.io/images/hgftikht/production/cb2c44f6ee3262afd0861f53e88a0b3ab2ce4993-1200x675.jpg?w=300&h=169&fit=crop 300w,\nhttps://cdn.sanity.io/images/hgftikht/production/cb2c44f6ee3262afd0861f53e88a0b3ab2ce4993-1200x675.jpg?w=600&h=338&fit=crop 600w,\nhttps://cdn.sanity.io/images/hgftikht/production/cb2c44f6ee3262afd0861f53e88a0b3ab2ce4993-1200x675.jpg 1200w","srcWebp":"https://cdn.sanity.io/images/hgftikht/production/cb2c44f6ee3262afd0861f53e88a0b3ab2ce4993-1200x675.jpg?fm=webp","srcSetWebp":"https://cdn.sanity.io/images/hgftikht/production/cb2c44f6ee3262afd0861f53e88a0b3ab2ce4993-1200x675.jpg?w=300&h=169&fit=crop&fm=webp 300w,\nhttps://cdn.sanity.io/images/hgftikht/production/cb2c44f6ee3262afd0861f53e88a0b3ab2ce4993-1200x675.jpg?w=600&h=338&fit=crop&fm=webp 600w,\nhttps://cdn.sanity.io/images/hgftikht/production/cb2c44f6ee3262afd0861f53e88a0b3ab2ce4993-1200x675.jpg?fm=webp 1200w","sizes":"(max-width: 1200px) 100vw, 1200px"}}},"_rawBody":[{"_key":"8a37daffe0a0","_type":"block","children":[{"_key":"32bdc1514475","_type":"span","marks":[],"text":"I love Terraform."}],"markDefs":[],"style":"normal"},{"_key":"136a905835c6","_type":"block","children":[{"_key":"8a8c9ed035860","_type":"span","marks":[],"text":"Aside from CloudFormation for AWS or OpenStack Heat, it's the single most useful open-source tool out there for deploying and provisioning infrastructure on any platform. However, there is one pattern that I've noticed since using Terraform that worries me:"}],"markDefs":[],"style":"normal"},{"_key":"cd49d452b09e","_type":"block","children":[{"_key":"3bab10cb0f170","_type":"span","marks":["em"],"text":"terraform plan # \"looks good; ship it,\" says the engineer! \nterraform apply"}],"markDefs":[],"style":"normal"},{"_key":"bab332338bf0","_type":"block","children":[{"_key":"d47f335b9ca3","_type":"span","marks":[],"text":"This probably isn't a problem if you're deploying to a single rack in a datacenter or a test AWS account with really limited privileges. You can't do too much harm there."}],"markDefs":[],"style":"normal"},{"_key":"e8a298154857","_type":"block","children":[{"_key":"3f94d9abff790","_type":"span","marks":[],"text":"But what if you're deploying with an all-encompassing \"production\" account or to an entire datacenter? Doesn't this seem pretty risky?"}],"markDefs":[],"style":"normal"},{"_key":"8af58962c004","_type":"block","children":[{"_key":"3b485645c2f80","_type":"span","marks":[],"text":"Unit and integration testing solves this problem. \"Unit testing, like for apps?\", I hear you say? Yup, that unit testing!"}],"markDefs":[],"style":"normal"},{"_key":"e692d5298a12","_type":"block","children":[{"_key":"72593f78e70f0","_type":"span","marks":[],"text":"This post will briefly cover what unit and integration testing is, the challenges involved in doing these against infrastructure and testing strategies that I've observed in the field. This post will also briefly cover deployment strategies for your infrastructure as they relate to testing. While a healthy dose of code is used to drive these talking points, no technical knowledge is required to follow along."}],"markDefs":[],"style":"normal"},{"_key":"e280c49d86d2","_type":"block","children":[{"_key":"f946099cd8a9","_type":"span","marks":[],"text":"Need a way to visualise how you test and how your tests integrate with one another? Check out the "},{"_key":"f5881b7b222d","_type":"span","marks":["4d35d1818b13"],"text":"Testing Pyramid"},{"_key":"bebab28ffee8","_type":"span","marks":[],"text":"."}],"markDefs":[{"_key":"4d35d1818b13","_type":"link","blank":true,"href":"https://www.contino.io/insights/the-testing-pyramid"}],"style":"normal"},{"_key":"4bfc7d35ab88","_type":"block","children":[{"_key":"e337180449e0","_type":"span","marks":[],"text":"Want more Terraform? Check out our related Terraform blogs: "}],"markDefs":[],"style":"normal"},{"_key":"07b7c23ae490","_type":"block","children":[{"_key":"34f0c39586d1","_type":"span","marks":["a11ae0ba4950"],"text":"A Model for Scaling Terraform workflows in a Large, Complex Organization"},{"_key":"46cdba9f884a","_type":"span","marks":[],"text":""}],"level":1,"listItem":"bullet","markDefs":[{"_key":"a11ae0ba4950","_type":"link","blank":true,"href":"https://www.contino.io/insights/a-model-for-scaling-terraform-workflows-in-a-large-complex-organization"}],"style":"normal"},{"_key":"f9d9a1a5422f","_type":"block","children":[{"_key":"c6efdd2c744b","_type":"span","marks":[],"text":""},{"_key":"24d22048e3df","_type":"span","marks":["1976548cc819"],"text":"Using Terraform to enforce AWS infrastructure best practices"},{"_key":"e4691ce4d9a6","_type":"span","marks":[],"text":""}],"level":1,"listItem":"bullet","markDefs":[{"_key":"a11ae0ba4950","_type":"link","blank":true,"href":"https://www.contino.io/insights/a-model-for-scaling-terraform-workflows-in-a-large-complex-organization"},{"_key":"1976548cc819","_type":"link","blank":true,"href":"https://www.contino.io/insights/using-terraform-to-enforce-aws-infrastructure-best-practices-1"}],"style":"normal"},{"_key":"6d06d96b4c87","_type":"block","children":[{"_key":"67a4bf4d1105","_type":"span","marks":["b78ebac4ff82"],"text":""},{"_key":"1859086f61f2","_type":"span","marks":["b78ebac4ff82"],"text":"Leveraging HashiCorp Terraform to Make AWS Spot Instances More Effective"},{"_key":"26046c3c19dc","_type":"span","marks":[],"text":""}],"level":1,"listItem":"bullet","markDefs":[{"_key":"a11ae0ba4950","_type":"link","blank":true,"href":"https://www.contino.io/insights/a-model-for-scaling-terraform-workflows-in-a-large-complex-organization"},{"_key":"1976548cc819","_type":"link","blank":true,"href":"https://www.contino.io/insights/using-terraform-to-enforce-aws-infrastructure-best-practices-1"},{"_key":"b78ebac4ff82","_type":"link","blank":true,"href":"https://www.contino.io/insights/leveraging-hashicorp-terraform-to-make-aws-spot-instances-more-effective"}],"style":"normal"},{"_key":"9c2473d88a51","_type":"block","children":[{"_key":"97ad4dd8c932","_type":"span","marks":["bf4c6834a169"],"text":"Terraform: Cloud Made Easy"},{"_key":"2d93580553ee","_type":"span","marks":[],"text":""}],"level":1,"listItem":"bullet","markDefs":[{"_key":"a11ae0ba4950","_type":"link","blank":true,"href":"https://www.contino.io/insights/a-model-for-scaling-terraform-workflows-in-a-large-complex-organization"},{"_key":"1976548cc819","_type":"link","blank":true,"href":"https://www.contino.io/insights/using-terraform-to-enforce-aws-infrastructure-best-practices-1"},{"_key":"b78ebac4ff82","_type":"link","blank":true,"href":"https://www.contino.io/insights/leveraging-hashicorp-terraform-to-make-aws-spot-instances-more-effective"},{"_key":"bf4c6834a169","_type":"link","blank":true,"href":"https://www.contino.io/insights/terraform-cloud-made-easy-part-one"}],"style":"normal"},{"_key":"8451b630fbb9","_type":"block","children":[{"_key":"886424918107","_type":"span","marks":["c16860a22647"],"text":""},{"_key":"d183cd5008c8","_type":"span","marks":["c16860a22647"],"text":"The Ultimate Guide to Passing the HashiCorp Certified Terraform Associate Exam"},{"_key":"cfa20aa88d74","_type":"span","marks":[],"text":""}],"level":1,"listItem":"bullet","markDefs":[{"_key":"a11ae0ba4950","_type":"link","blank":true,"href":"https://www.contino.io/insights/a-model-for-scaling-terraform-workflows-in-a-large-complex-organization"},{"_key":"1976548cc819","_type":"link","blank":true,"href":"https://www.contino.io/insights/using-terraform-to-enforce-aws-infrastructure-best-practices-1"},{"_key":"b78ebac4ff82","_type":"link","blank":true,"href":"https://www.contino.io/insights/leveraging-hashicorp-terraform-to-make-aws-spot-instances-more-effective"},{"_key":"bf4c6834a169","_type":"link","blank":true,"href":"https://www.contino.io/insights/terraform-cloud-made-easy-part-one"},{"_key":"c16860a22647","_type":"link","blank":true,"href":"https://www.contino.io/insights/hashicorp-certified-terraform-associate-exam"}],"style":"normal"},{"_key":"371f95b97715","_type":"block","children":[{"_key":"c7a35202d0fc0","_type":"span","marks":[],"text":"A Brief Intro to Software Testing"}],"markDefs":[],"style":"h2"},{"_key":"2615d6d03e77","_type":"block","children":[{"_key":"4a108b00d00d0","_type":"span","marks":[],"text":"Software developers use "},{"_key":"4a108b00d00d1","_type":"span","marks":["em"],"text":"unit testing"},{"_key":"4a108b00d00d2","_type":"span","marks":[],"text":" to check that individual functions work as they should. They then use "},{"_key":"4a108b00d00d3","_type":"span","marks":["em"],"text":"integration testing"},{"_key":"4a108b00d00d4","_type":"span","marks":[],"text":" to test that their feature works well with the application as a whole. Let's use an example to illustrate the difference.\n\nLet's say that I was writing a calculator app in a fictional pseudo-language and wrote a function that adds two numbers. It might look like this:"}],"markDefs":[],"style":"normal"},{"_key":"a125bae74bb3","_type":"block","children":[{"_key":"56d04f697f360","_type":"span","marks":["em"],"text":"function addTwoNumbers(integer firstNumber, integer secondNumber) { \n return (firstNumber + secondNumber); \n}"}],"markDefs":[],"style":"normal"},{"_key":"165851eba94c","_type":"block","children":[{"_key":"35ca6379a6ed0","_type":"span","marks":[],"text":"A unit test that ensured that this function worked as it should might look something like this:"}],"markDefs":[],"style":"normal"},{"_key":"b99e9dcb8108","_type":"block","children":[{"_key":"b3267b7a4c820","_type":"span","marks":["em"],"text":"function testAddTwoNumbers() { \n firstNumber = 2; \n secondNumber = 4; \n expected = 6; \n actual = addTwoNumbers(firstNumber, secondNumber); \n if ( expectedResult != actualResult ) { \n   return testFailed(\"Expected %s but got %s\", expected, actual); \n   } \n   return testPassed(); \n}"}],"markDefs":[],"style":"normal"},{"_key":"deb5c04739f1","_type":"block","children":[{"_key":"cabc0b05ea4d0","_type":"span","marks":[],"text":"As you can see, this test only focuses on testing that "},{"_key":"cabc0b05ea4d1","_type":"span","marks":["em"],"text":"addTwoNumbers"},{"_key":"cabc0b05ea4d2","_type":"span","marks":[],"text":", well, adds two numbers. While this might seem trivial, many of the large project failures that have happened over the years occurred because tests like these were missing!"}],"markDefs":[],"style":"normal"},{"_key":"bfa0fc2f8069","_type":"block","children":[{"_key":"1aab37ba6add0","_type":"span","marks":[],"text":"Testing that this function works across the application as a whole is trickier, however, as doing this successfully heavily depends on the application and its dependencies. "},{"_key":"6499851bcb9d","_type":"span","marks":["48c799771b41"],"text":"Integration testing"},{"_key":"fe4450ba1763","_type":"span","marks":[],"text":""},{"_key":"7eeaadda6aec","_type":"span","marks":[],"text":" a calculator app is somewhat straightforward:"}],"markDefs":[{"_key":"48c799771b41","_type":"link","blank":true,"href":"https://www.contino.io/insights/integration-testing"}],"style":"normal"},{"_key":"ad8af90265e6","_type":"block","children":[{"_key":"47a50f21951c0","_type":"span","marks":["em"],"text":"Calculator testCalculator = new Calculator(); \nfirstNumber = 1; \nsecondNumber = 2; \nexpected = 3; actual = testCalculator.addTwoNumbers(firstNumber, secondNumber); \n\n# add other tests here \n\nTest testAddTwoNumbers { \n if ( expected != actual ) { \n  testFailed(\"Expected %s, but got %s.\", expected, actual); \n  } testPassed(); \n}"}],"markDefs":[],"style":"normal"},{"_key":"62628bc027e6","_type":"block","children":[{"_key":"614a7b867a400","_type":"span","marks":[],"text":"As you can see, we create a testCalculator object based on the class from which it was created and ensure that, amongst other things, it can add two numbers like you'd expect. While the unit test tested this function in isolation of the rest of the Calculator class, the integration test brings it all together to ensure that changes to addCalculator don't break the entire application."}],"markDefs":[],"style":"normal"},{"_key":"78c45d1b88be","_type":"block","children":[{"_key":"89a206bdc57d0","_type":"span","marks":[],"text":"“I deploy infrastructure, Carlos. Why should I care about this?”"}],"markDefs":[],"style":"h2"},{"_key":"85b245d32a29","_type":"block","children":[{"_key":"9585ded2870d0","_type":"span","marks":[],"text":"Here's why."}],"markDefs":[],"style":"normal"},{"_key":"88f72b73368b","_type":"block","children":[{"_key":"d37ae2653e1c0","_type":"span","marks":[],"text":"Have you written a script like this..."}],"markDefs":[],"style":"normal"},{"_key":"d134635dc706","_type":"block","children":[{"_key":"9222cace7c550","_type":"span","marks":["em"],"text":"function increaseDiskSize(string smbComputerName, string driveLetter) \n{ \n wmiQueryResult = new wmiObject(\"SELECT * FROM WIN32_LOGICALDISK WHERE DRIVELETTER = \\\"%s\\\"\", driveLetter) \n if ( wmiQuery != null ) { \n   # do stuff \n   } \n}"}],"markDefs":[],"style":"normal"},{"_key":"1d628e620b5a","_type":"block","children":[{"_key":"91491802d32f0","_type":"span","marks":[],"text":"...and hoped that it worked as it should? Did you re-run it a few times and change some things on that ‘lab’ box that you ran this against until you got the result you wanted? Did you run this during a change window against a ‘production’ machine, only to be surprised that it didn't work as you intended? Did you lose an evening or weekend to this?"}],"markDefs":[],"style":"normal"},{"_key":"943a20181a46","_type":"block","children":[{"_key":"d40b38b9d9970","_type":"span","marks":[],"text":"If so, then can you spot what's wrong with this pattern?"}],"markDefs":[],"style":"normal"},{"_key":"7b33d2149c49","_type":"block","children":[{"_key":"1922bef3cb950","_type":"span","marks":["em"],"text":"terraform plan # \"looks good; ship it,\" says the engineer! \nterraform apply"}],"markDefs":[],"style":"normal"},{"_key":"f219c2ec433a","_type":"block","children":[{"_key":"aeef558c551d0","_type":"span","marks":[],"text":"It's the same thing!"}],"markDefs":[],"style":"normal"},{"_key":"8de620c9db32","_type":"block","children":[{"_key":"4a1ebf7c73070","_type":"span","marks":[],"text":"Terraform Testing Strategy #1: Eye-Balling It"}],"markDefs":[],"style":"h2"},{"_key":"9da9e75c8fa4","_type":"block","children":[{"_key":"3b2ff56a8b9a","_type":"span","marks":[],"text":""}],"markDefs":[],"style":"normal"},{"_key":"63c32e3b719d","_type":"imageArticle","asset":{"_id":"image-fdcfebf4285190e4720ce2303035b4ea04094c55-380x499-jpg","_type":"sanity.imageAsset","_rev":"qD2nwhohCpR7vPHyE9cAsP","_createdAt":"2020-09-17T17:23:48Z","_updatedAt":"2020-09-17T17:23:48Z","assetId":"fdcfebf4285190e4720ce2303035b4ea04094c55","extension":"jpg","metadata":{"_type":"sanity.imageMetadata","dimensions":{"_type":"sanity.imageDimensions","aspectRatio":0.7615230460921844,"height":499,"width":380},"hasAlpha":false,"isOpaque":true,"lqip":"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAaABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAMFBwgG/8QAJRAAAgICAQMDBQAAAAAAAAAAAQIDBAAREgUGIQdBUSIxMjRh/8QAFQEBAQAAAAAAAAAAAAAAAAAABQT/xAAgEQACAQMEAwAAAAAAAAAAAAABAwACBBEFEhNBUaHh/9oADAMBAAIRAxEAPwDUHUbBrVXkXXIDwDkN0/rVie4kUqIqN7jIr1EuGkYX5HRUggNrOK7W7kgt2p6sEhmdfuxk/HD3XtK28XctRb1sVVWKcgd+JdmGJpfqQ7O/pHnDLxIpXXrJVmnrVGhi5heXn48ZVnZfbtupfrzrABI78XAB8rv3zTNmNJI9SIrD4YbxFevCjbWKNT/FAwm608ObybsZx6idtqTEJKQAQfsfUUrWiUjRCgYY3DF4ZP/Z","palette":{"_type":"sanity.imagePalette","darkMuted":{"_type":"sanity.imagePaletteSwatch","background":"#922706","foreground":"#fff","population":0,"title":"#fff"},"darkVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#912706","foreground":"#fff","population":0.49,"title":"#fff"},"dominant":{"_type":"sanity.imagePaletteSwatch","background":"#d4cba1","foreground":"#000","population":3.69,"title":"#000"},"lightMuted":{"_type":"sanity.imagePaletteSwatch","background":"#d4cba1","foreground":"#000","population":3.69,"title":"#000"},"lightVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#ebaa83","foreground":"#000","population":0.42,"title":"#fff"},"muted":{"_type":"sanity.imagePaletteSwatch","background":"#aa995c","foreground":"#000","population":3.42,"title":"#fff"},"vibrant":{"_type":"sanity.imagePaletteSwatch","background":"#df1711","foreground":"#fff","population":1.09,"title":"#fff"}}},"mimeType":"image/jpeg","originalFilename":"Eyeballing-it_f5a6d79dc87fc33a0ae83847f66b65e8[1].jpg","path":"images/hgftikht/production/fdcfebf4285190e4720ce2303035b4ea04094c55-380x499.jpg","sha1hash":"fdcfebf4285190e4720ce2303035b4ea04094c55","size":30321,"uploadId":"E5zAwJfK26sT65d7BHnWFaIS2R5FJ3T1","url":"https://cdn.sanity.io/images/hgftikht/production/fdcfebf4285190e4720ce2303035b4ea04094c55-380x499.jpg","id":"image-fdcfebf4285190e4720ce2303035b4ea04094c55-380x499-jpg","parent":null,"children":["c63fcf6d-c202-51f6-bfcf-6bb7ab5ac9d5"],"internal":{"type":"SanityImageAsset","contentDigest":"07701468eb4c22d8a623e989c7678ccd","counter":2672,"owner":"gatsby-source-sanity"}}},{"_key":"c913000d4a44","_type":"block","children":[{"_key":"8e91f6b84aaa","_type":"span","marks":[],"text":"Being able to use "},{"_key":"8d9cc065411a","_type":"span","marks":["em"],"text":"terraform plan"},{"_key":"da0c331f21b6","_type":"span","marks":[],"text":" to see what Terraform will do before it does it is one of Terraform's most stand-out features. As such, it was designed for practitioners to see what would happen before a run occurred, check that everything looks good before applying it and then running "},{"_key":"e5ab72957650","_type":"span","marks":["em"],"text":"terraform apply"},{"_key":"8b357042f087","_type":"span","marks":[],"text":" to add the finishing touches."}],"markDefs":[],"style":"normal"},{"_key":"79cbc3f20214","_type":"block","children":[{"_key":"374039eabca40","_type":"span","marks":[],"text":"Let's say you're deploying a "},{"_key":"58b0544585d2","_type":"span","marks":["7e469bc7b668"],"text":"Kubernetes"},{"_key":"d1d68cc7cff4","_type":"span","marks":[],"text":""},{"_key":"2c3910e45b22","_type":"span","marks":[],"text":" cluster on AWS with a VPC and an EC2 keypair. The code for this might look like this (without workers):"}],"markDefs":[{"_key":"7e469bc7b668","_type":"link","blank":true,"href":"https://www.contino.io/insights/5-reasons-to-love-kubernetes"}],"style":"normal"},{"_key":"97b299032a3c","_type":"block","children":[{"_key":"c3d6734378140","_type":"span","marks":["em"],"text":"provider \"aws\" { \n   region = \"${var.aws_region}\" \n} \n\nresource \"aws_vpc\" \"infrastructure\" { \n  cidr_block = \"10.1.0.0/16\" \n  tags = { \n    Name = \"vpc.domain.internal\" \n    Environment = \"dev\" \n  } \n} \n\nresource \"aws_key_pair\" \"keypair\" { \n  key_name = \"${var.key_name}\" \n  public_key = \"${var.public_key}\" \n} \n\nresource \"aws_instance\" \"kubernetes_controller\" { \n  ami = \"${data.aws_ami.kubernetes_instances.id}\" \n  instance_type = \"${var.kubernetes_controller_instance_size}\" count = 3 \n}"}],"markDefs":[],"style":"normal"},{"_key":"f696472cde1f","_type":"block","children":[{"_key":"712ffda5f5d10","_type":"span","marks":[],"text":"If you're eyeballing it, you would run "},{"_key":"712ffda5f5d11","_type":"span","marks":["em"],"text":"terraform plan"},{"_key":"712ffda5f5d12","_type":"span","marks":[],"text":", confirm that it does what you'd expect (after providing variables accordingly) and execute "},{"_key":"712ffda5f5d13","_type":"span","marks":["em"],"text":"terraform apply"},{"_key":"712ffda5f5d14","_type":"span","marks":[],"text":" to apply your changes."}],"markDefs":[],"style":"normal"},{"_key":"e3e23ecff81a","_type":"block","children":[{"_key":"df8e45d9d4810","_type":"span","marks":[],"text":"Advantages"}],"markDefs":[],"style":"h3"},{"_key":"f822475e35a3","_type":"block","children":[{"_key":"a821936c0b440","_type":"span","marks":["strong"],"text":"Really quick development time"}],"markDefs":[],"style":"normal"},{"_key":"ae8b33f8abbf","_type":"block","children":[{"_key":"e12113352bad0","_type":"span","marks":[],"text":"This works well if your scale is small or if you're writing a quick configuration to test something new. The feedback cycle is really quick (write code, "},{"_key":"e12113352bad1","_type":"span","marks":["em"],"text":"terraform plan"},{"_key":"e12113352bad2","_type":"span","marks":[],"text":", check, then "},{"_key":"e12113352bad3","_type":"span","marks":["em"],"text":"terraform apply"},{"_key":"e12113352bad4","_type":"span","marks":[],"text":" if it's good); consequently, this enables you to churn new configurations rather quickly."}],"markDefs":[],"style":"normal"},{"_key":"bad81c7473bf","_type":"block","children":[{"_key":"84c5a24a3931","_type":"span","marks":["strong"],"text":"Shallow learning curve"}],"markDefs":[],"style":"normal"},{"_key":"58d9f991d406","_type":"block","children":[{"_key":"0af1da10be5c0","_type":"span","marks":[],"text":"You can have anybody with any familiarity with Terraform, programming or systems administration do this. The plan tells you (almost) everything that you need to know."}],"markDefs":[],"style":"normal"},{"_key":"fe3df6c64024","_type":"block","children":[{"_key":"563b8d0dfd620","_type":"span","marks":[],"text":"Disadvantages"}],"markDefs":[],"style":"h3"},{"_key":"ad2fb8f08751","_type":"block","children":[{"_key":"020b05e3d46c0","_type":"span","marks":["strong"],"text":"It's hard to spot mistakes this way"}],"markDefs":[],"style":"normal"},{"_key":"69aba1bbb9e5","_type":"block","children":[{"_key":"5f8c52713fc20","_type":"span","marks":[],"text":"Let's say you read the "},{"_key":"5f8c52713fc21","_type":"span","marks":["f364290dbb70"],"text":"whitepaper on Borg"},{"_key":"5f8c52713fc22","_type":"span","marks":[],"text":" and, in kind, wanted to deploy five replicas of your Kubernetes master instead of three. You check the plan really quickly and apply it, thinking that all is good. Except, wait! I deployed three masters instead of five!\n\nThe remediation is harmless in this case: change your variables.tf to deploy five Kubernetes masters and redeploy. However, the remediation would be much more painful if this were done in production and your feature teams had already deployed services onto it."}],"markDefs":[{"_key":"f364290dbb70","_type":"link","href":"https://pdos.csail.mit.edu/6.824/papers/borg.pdf"}],"style":"normal"},{"_key":"bfa92cdeaa31","_type":"block","children":[{"_key":"42c4e5c61f4b","_type":"span","marks":[],"text":""},{"_key":"396b31f8a27e","_type":"span","marks":["strong"],"text":"It doesn't scale well"}],"markDefs":[{"_key":"f364290dbb70","_type":"link","href":"https://pdos.csail.mit.edu/6.824/papers/borg.pdf"}],"style":"normal"},{"_key":"2a70125a7438","_type":"block","children":[{"_key":"86e41b1759b80","_type":"span","marks":[],"text":"Eyeballing works well when you're just getting started with Terraform, as you're not deploying very much through it in the beginning or you are, at best, using it for a very small portion of your infrastructure.\n\n"},{"_key":"86e41b1759b81","_type":"span","marks":["e6aa0d34fa86"],"text":"Things get much trickier"},{"_key":"86e41b1759b82","_type":"span","marks":[],"text":" once you begin deploying between tens and hundreds of different infrastructure components with tens or hundreds of servers each. "},{"_key":"86e41b1759b83","_type":"span","marks":["090572e2333a"],"text":"Modules"},{"_key":"86e41b1759b84","_type":"span","marks":[],"text":" are a good example of this. Take a look at this configuration:"}],"markDefs":[{"_key":"e6aa0d34fa86","_type":"link","href":"http://www.contino.io/insights/a-model-for-scaling-terraform-workflows-in-a-large-complex-organization"},{"_key":"090572e2333a","_type":"link","href":"https://www.terraform.io/docs/modules/usage.html"}],"style":"normal"},{"_key":"a66970a8740e","_type":"block","children":[{"_key":"f0b12a26994e","_type":"span","marks":["em"],"text":"# main.tf \nmodule \"stack\" \"standard\" { \n  source = \"git@github.com:team/terraform_modules/stack.git\" \n  number_of_web_servers = 2 \n  number_of_db_servers = 2 \n  aws_account_to_use = \"${var.aws_account_number}\" \n  aws_access_key = \"${var.aws_access_key}\" \n  aws_secret_key = \"${var.aws_secret_key}\" \n  aws_region_to_deploy_into = \"${var.aws_region}\" \n  … \n}"}],"markDefs":[],"style":"normal"},{"_key":"7cf5f7594f84","_type":"block","children":[{"_key":"6c0c79e8e2e80","_type":"span","marks":[],"text":"It looks pretty straightforward: it tells you where the module is and what its input variables are. So you go to that repository to learn more about this module, only to find..."}],"markDefs":[],"style":"normal"},{"_key":"5cfc566ec808","_type":"block","children":[{"_key":"e22ad82ffb120","_type":"span","marks":["em"],"text":"# team/terraform_modules/stack/main.tf \nmodule \"web_server\" \"web_servers_in_stack\" { \n  source = \"git@github.com:team/terraform_modules/core/web.git\" \n  count = \"${var.number_of_web_servers}\" \n  type = \"${coalesce(var.web_server_type, \"IIS\")}\" \n  aws_access_key = \"${var.aws_access_key}\" \n  aws_secret_key = \"${var.aws_secret_key}\" \n  … \n} \n  \nmodule \"database_server\" \"db_servers_in_stack\" { \n  source = \"git@github.com:team/terraform_modules/core/db.git\" \n  count = \"${var.number_of_db_servers}\" \n  type = \"${coalesce(var.web_server_type, \"MSSQLServerExp2016\")}\" \n  aws_access_key = \"${var.aws_access_key}\" \n  aws_secret_key = \"${var.aws_secret_key}\" \n  … \n}"}],"markDefs":[],"style":"normal"},{"_key":"9fc5a09557cd","_type":"block","children":[{"_key":"70df4d94f69e0","_type":"span","marks":[],"text":"..."},{"_key":"70df4d94f69e1","_type":"span","marks":["em"],"text":"more modules"},{"_key":"70df4d94f69e2","_type":"span","marks":[],"text":"! As you can probably guess, trudging through chains of repositories or directories to find out what a Terraform configuration is doing is annoying at best and damaging at worst; performing this exercise during an outage can be costly!\n"}],"markDefs":[],"style":"normal"},{"_key":"5329002c6361","_type":"block","children":[{"_key":"9d53420adbe40","_type":"span","marks":[],"text":"Terraform Testing Strategy #2: Integration Testing First"}],"markDefs":[],"style":"h2"},{"_key":"ad5d60cf6f8c","_type":"block","children":[{"_key":"d91af1668baf","_type":"span","marks":[],"text":""}],"markDefs":[],"style":"normal"},{"_key":"78d77f234cac","_type":"imageArticle","asset":{"_id":"image-a2e93d0728e0269e31a93cba506aa88b841db92a-500x333-jpg","_type":"sanity.imageAsset","_rev":"2jL4beAYAvILht20WpBZGx","_createdAt":"2020-09-17T17:24:59Z","_updatedAt":"2020-09-17T17:24:59Z","assetId":"a2e93d0728e0269e31a93cba506aa88b841db92a","extension":"jpg","metadata":{"_type":"sanity.imageMetadata","dimensions":{"_type":"sanity.imageDimensions","aspectRatio":1.5015015015015014,"height":333,"width":500},"hasAlpha":false,"isOpaque":true,"lqip":"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABgAFB//EACUQAAICAgECBgMAAAAAAAAAAAIDAQQABREGUQcSISIxYRMUQf/EABYBAQEBAAAAAAAAAAAAAAAAAAQBAv/EABgRAAMBAQAAAAAAAAAAAAAAAAABERIx/9oADAMBAAIRAxEAPwDB17207oU417TsTMqZ7vSVx3nFlOg+TO6yjTrNgOFk5vJ+Xv8AeG/C0lq6Sr2XBL7TWe5rDmZ47YqVpB2GwruKwaxkZKQGPv45xy5QT7ATvekb13YnY1+oUyuyOYMGehT/AGcs6O58a0/1q4T+MfjkssuKY2kf/9k=","palette":{"_type":"sanity.imagePalette","darkMuted":{"_type":"sanity.imagePaletteSwatch","background":"#32495e","foreground":"#fff","population":3.81,"title":"#fff"},"darkVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#091b34","foreground":"#fff","population":0.13,"title":"#fff"},"dominant":{"_type":"sanity.imagePaletteSwatch","background":"#a8bfd1","foreground":"#000","population":6.18,"title":"#fff"},"lightMuted":{"_type":"sanity.imagePaletteSwatch","background":"#a8bfd1","foreground":"#000","population":6.18,"title":"#fff"},"lightVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#b4dcf4","foreground":"#000","population":0,"title":"#000"},"muted":{"_type":"sanity.imagePaletteSwatch","background":"#617f98","foreground":"#fff","population":5.87,"title":"#fff"},"vibrant":{"_type":"sanity.imagePaletteSwatch","background":"#94bcd0","foreground":"#000","population":0.06,"title":"#fff"}}},"mimeType":"image/jpeg","originalFilename":"Integration_f5a6d79dc87fc33a0ae83847f66b65e8[1].jpg","path":"images/hgftikht/production/a2e93d0728e0269e31a93cba506aa88b841db92a-500x333.jpg","sha1hash":"a2e93d0728e0269e31a93cba506aa88b841db92a","size":42155,"uploadId":"W3SNntvrcm9urOi9W6mZQz3XqSJ4GyIf","url":"https://cdn.sanity.io/images/hgftikht/production/a2e93d0728e0269e31a93cba506aa88b841db92a-500x333.jpg","id":"image-a2e93d0728e0269e31a93cba506aa88b841db92a-500x333-jpg","parent":null,"children":["d1fa49a7-46ec-5d79-8ab8-58b11960c9da"],"internal":{"type":"SanityImageAsset","contentDigest":"f54b1113f6575e6d4b84dbef58f71041","counter":2673,"owner":"gatsby-source-sanity"}}},{"_key":"322d4cad11c7","_type":"block","children":[{"_key":"30de1b458526","_type":"span","marks":[],"text":"To avoid the consequences from the approach above, your team might decide to use something like serverspec, Goss and/or "},{"_key":"0f1e2dee3700","_type":"span","marks":["85fa3e2161b9"],"text":"InSpec"},{"_key":"cbfb4e65fcbd","_type":"span","marks":[],"text":" to execute your plans first into a sandbox, automatically confirm that everything looks good then tear down your sandbox and collect results. If all of your tests pass, then you promote the deployment to a higher environment. If they fail, you create a defect story and remediate."}],"markDefs":[{"_key":"85fa3e2161b9","_type":"link","blank":true,"href":"https://github.com/chef/inspec"}],"style":"normal"},{"_key":"164f69f91aa6","_type":"block","children":[{"_key":"093d7809e3ac0","_type":"span","marks":[],"text":"If this were a pipeline in Jenkins or Bamboo CI, it would look something like this:"}],"markDefs":[],"style":"normal"},{"_key":"c09fc75b8854","_type":"block","children":[{"_key":"d24a9e1f8816","_type":"span","marks":[],"text":""}],"markDefs":[],"style":"normal"},{"_key":"ff7479b8db82","_type":"imageArticle","asset":{"_id":"image-291c426fa5b3908ff9e38523131b6217554243ab-558x443-png","_type":"sanity.imageAsset","_rev":"qD2nwhohCpR7vPHyE9cGjE","_createdAt":"2020-09-17T17:25:44Z","_updatedAt":"2020-09-17T17:25:44Z","assetId":"291c426fa5b3908ff9e38523131b6217554243ab","extension":"png","metadata":{"_type":"sanity.imageMetadata","dimensions":{"_type":"sanity.imageDimensions","aspectRatio":1.2595936794582392,"height":443,"width":558},"hasAlpha":true,"isOpaque":true,"lqip":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC2ElEQVQ4y22TSY/bRhCF9asN5Jo4V/uv5BDAhmEg8dU55GRoKFJkk71xERdR+0jU86uWNMYYFlBis7rr66pXxdlms0HXdVitVmjbFk3ToKoq+no89sQnT9lv6e/74dXZuq6xXq9xuVwwG8cxbIrzcSAvNJyv0Q/r4CvLMuwb62BcjbppX0Bi3nsm1OJ8JlDINTetMTDaIM8LxEkKVTgGrWCM+HJorZFlOXLtYG2JXOUoihzOSlxBcEXgM4FtBacV0iTGYhEjisQSKKUJMvQtg2+5TIMVvFAR/DSfYzH/hjxdwKgEbW1xOW0x27QWTWlgmYEuDG9lRqqAYdlGW2ZVBLi1nvt8hqwszyholaL2Bo0vsG40pl1DYMcGtE3QShojmkiJBQO8k/IsnJPyqSEvNQSu7lqXpaf+jCkdulLhMnrMhpVD6W3QylrRS2HxNEcaRyFYZWkwo6lftoTJM1TeMVspPWMcK8uZqY4JdNSQQGdugRkPpKLVIkK+XEClS8RRRJML+L5MWDJLZQVJHCORc1lCDWN0PmPJK8x2PUtuSpZnmamMQssmsXMqu3dduquQpVnQ0xofuqwLy7VluR5N5TD2K0znI4FDjaG/zWHbdhjHDTzLMBS8qRvO2G0uC8IVu16YClXdBk1F9/4++H3fY5omalhreMsAamcJkrlSyRM0x6Hi7TJ/acpxoWYC1sywrHgRh70UKBspgy0fxw1YEaQiFMs5IVEwmz2hsSnFtwSaAHt0WqqQzI2MFiWoCZbp2G63uF6vmD3vOuzXNXZ9if1Qcd3gOLY47QYc9jvs9/tgh8MBp9MJz7Sd4+z9+w+qjx+wZsOOuy2/4+kGxHTBzc635/VhE/iHl9/1tp4I3P//H/r3f6L74zdsPv2N83q4HyHweg97ZdeHXV/ZD+BX9O/eov/9DTYf/sJ56O9xAvwp6FeQV2sK/1x5bL98xkjYIfqG6Xh8OfcdumSpbOWsEGEAAAAASUVORK5CYII=","palette":{"_type":"sanity.imagePalette","darkMuted":{"_type":"sanity.imagePaletteSwatch","background":"#474639","foreground":"#fff","population":0.06,"title":"#fff"},"darkVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#93503d","foreground":"#fff","population":0.05,"title":"#fff"},"dominant":{"_type":"sanity.imagePaletteSwatch","background":"#cdc6ba","foreground":"#000","population":3.8,"title":"#fff"},"lightMuted":{"_type":"sanity.imagePaletteSwatch","background":"#cdc6ba","foreground":"#000","population":3.8,"title":"#fff"},"lightVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#e6bc91","foreground":"#000","population":0.96,"title":"#fff"},"muted":{"_type":"sanity.imagePaletteSwatch","background":"#a56e72","foreground":"#fff","population":0.14,"title":"#fff"},"vibrant":{"_type":"sanity.imagePaletteSwatch","background":"#e43225","foreground":"#fff","population":1.37,"title":"#fff"}}},"mimeType":"image/png","originalFilename":"Terraform-Pipeline_f5a6d79dc87fc33a0ae83847f66b65e8[1].png","path":"images/hgftikht/production/291c426fa5b3908ff9e38523131b6217554243ab-558x443.png","sha1hash":"291c426fa5b3908ff9e38523131b6217554243ab","size":195328,"uploadId":"yfgt4a6fgsMRxz4huqe0odpPGTRWhl5x","url":"https://cdn.sanity.io/images/hgftikht/production/291c426fa5b3908ff9e38523131b6217554243ab-558x443.png","id":"image-291c426fa5b3908ff9e38523131b6217554243ab-558x443-png","parent":null,"children":["e51f47fe-a55a-5a51-924a-8f0474b285f8"],"internal":{"type":"SanityImageAsset","contentDigest":"4e04d15749f7848769175393e39f1ea5","counter":2677,"owner":"gatsby-source-sanity"}}},{"_key":"80ac974eaa78","_type":"block","children":[{"_key":"6170e45a9df1","_type":"span","marks":["strong"],"text":"Figure 1: An example of an infrastructure deployment pipeline with integration tests. Orange border indicates steps executed within sandbox."}],"markDefs":[],"style":"normal"},{"_key":"03b2b66db804","_type":"block","children":[{"_key":"a3aa074ff13c0","_type":"span","marks":[],"text":"This is a great step in the right direction, but there are some potential pitfalls to consider.\n"}],"markDefs":[],"style":"normal"},{"_key":"25c781237ae2","_type":"block","children":[{"_key":"50d50ba21dcb0","_type":"span","marks":[],"text":"Advantages"}],"markDefs":[],"style":"h3"},{"_key":"926ea35caac1","_type":"block","children":[{"_key":"bbe1d22448ea0","_type":"span","marks":["strong"],"text":"Removes the need for long-lived development environments and encourages immutable infrastructure"}],"markDefs":[],"style":"normal"},{"_key":"0417678186e9","_type":"block","children":[{"_key":"d0a504836c860","_type":"span","marks":[],"text":"A common practice I've seen amongst many IT teams is creating a long-lived development environment or 'sandbox' to test certain things like tool upgrades or script changes. These environments are typically stratified from production seriously enough to where changes that ‘work in dev’ break in production. This encourages ‘testing in production’, which opens the door to human error and, ultimately, outages."}],"markDefs":[],"style":"normal"},{"_key":"33154a2a93cf","_type":"block","children":[{"_key":"8a3d72309db70","_type":"span","marks":[],"text":"Well-written integration tests provide enough confidence to do away with this practice completely."}],"markDefs":[],"style":"normal"},{"_key":"86213bda492a","_type":"block","children":[{"_key":"8071b33b88550","_type":"span","marks":[],"text":"Every sandbox environment created by an integration test will be an exact replica of production "},{"_key":"8071b33b88551","_type":"span","marks":["em"],"text":"because every sandbox environment will ultimately become production."},{"_key":"8071b33b88552","_type":"span","marks":[],"text":" This provides a key building block towards "},{"_key":"8071b33b88553","_type":"span","marks":["ab40cf59b51f"],"text":"infrastructure immutability"},{"_key":"8071b33b88554","_type":"span","marks":[],"text":" whereby any changes to production become part of a hotfix or future feature release, and "},{"_key":"8071b33b88555","_type":"span","marks":["em"],"text":"no changes to production are allowed or even needed."},{"_key":"8071b33b88556","_type":"span","marks":[],"text":"\n\nTo be clear, this does "},{"_key":"8071b33b88557","_type":"span","marks":["strong"],"text":"not"},{"_key":"8071b33b88558","_type":"span","marks":[],"text":" mean that this does away with development environments for feature teams (though integration tests in software applications remove the need for development environments there as well; this is beyond the scope of this post, however)."}],"markDefs":[{"_key":"ab40cf59b51f","_type":"link","href":"https://blog.codeship.com/immutable-infrastructure/"}],"style":"normal"},{"_key":"690981e5f9c4","_type":"block","children":[{"_key":"b5302d8623a00","_type":"span","marks":["strong"],"text":"Documents your infrastructure"}],"markDefs":[],"style":"normal"},{"_key":"e16040271230","_type":"block","children":[{"_key":"2f705cef99e60","_type":"span","marks":[],"text":"You no longer have to wade through chains of modules to make sense of what your infrastructure is doing. If you have 100% test coverage of your Terraform code (a caveat that is explained in the following section), your tests tell the entire story and serve as a contract to which your infrastructure must adhere."}],"markDefs":[],"style":"normal"},{"_key":"90b01f41e1a0","_type":"block","children":[{"_key":"24c27c0fd44a0","_type":"span","marks":["strong"],"text":"Allows for version tagging and \"releases\" of your infrastructure"}],"markDefs":[],"style":"normal"},{"_key":"5dbbbaf8b067","_type":"block","children":[{"_key":"4371da2ddb1a0","_type":"span","marks":["a7ac43dfd2e3"],"text":"Because integration tests are meant to test your entire system"},{"_key":"4371da2ddb1a1","_type":"span","marks":[],"text":" cohesively, you can use them to tag your Terraform code with "},{"_key":"4371da2ddb1a2","_type":"span","marks":["em"],"text":"git tag"},{"_key":"4371da2ddb1a3","_type":"span","marks":[],"text":" or similar. This can be useful for rolling back to previous states (especially when combined with a "},{"_key":"4371da2ddb1a4","_type":"span","marks":["d98822846269"],"text":"blue/green deployment strategy"},{"_key":"4371da2ddb1a5","_type":"span","marks":[],"text":") or enabling developers within your organization to test differences in their features between iterations of your infrastructure."}],"markDefs":[{"_key":"a7ac43dfd2e3","_type":"link","href":"https://medium.com/android-testing-daily/unit-test-vs-integration-tes-fba13b92fbf6"},{"_key":"d98822846269","_type":"link","href":"https://docs.cloudfoundry.org/devguide/deploy-apps/blue-green.html"}],"style":"normal"},{"_key":"5adcd7b89620","_type":"block","children":[{"_key":"897626f48f900","_type":"span","marks":["strong"],"text":"They can serve as a first-line-of-defense"}],"markDefs":[],"style":"normal"},{"_key":"25be866505db","_type":"block","children":[{"_key":"cb255e63f9690","_type":"span","marks":[],"text":"If your integration tests are mature enough, they can be used as an early warning of unexpected third-party errors."}],"markDefs":[],"style":"normal"},{"_key":"4d4d20b2d786","_type":"block","children":[{"_key":"ad7ae9d2d5820","_type":"span","marks":[],"text":"To illustrate this, let's say that you created a pipeline in Jenkins or Bamboo that runs integration tests against your Terraform infrastructure twice daily and pages you if an integration test fails.\n\nA few days later, you receive an alert saying that an integration test failed. Upon checking the build log, you see an error from Chef saying that it failed to install IIS because the installer could not be found. After digging some more, you discover that the URL that was provided to the IIS installation cookbook has expired and needs an update.\n\nAfter cloning the repository within which this cookbook resides, updating the URL, re-running your integration tests locally and waiting for them to pass, you submit a pull request to the team that owns this repository asking them to integrate.\n\nCongratulations! You just saved yourself a work weekend by fixing your code proactively instead of waiting for it to surface come release time."}],"markDefs":[],"style":"normal"},{"_key":"6bcf08721b9c","_type":"block","children":[{"_key":"abc0575081d70","_type":"span","marks":[],"text":"Disadvantages"}],"markDefs":[],"style":"h3"},{"_key":"31f502d559ec","_type":"block","children":[{"_key":"baf308cedec80","_type":"span","marks":["strong"],"text":"It can get quite slow"}],"markDefs":[],"style":"normal"},{"_key":"85a416ee4de5","_type":"block","children":[{"_key":"435b1ee1fd200","_type":"span","marks":[],"text":"Depending on the number of resources your Terraform configuration creates and the number of modules they reference, doing a Terraform run might be costly. This can create very slow feedback loops whereby an engineer will make a change, wait for integration testing to finish, find out that their change broke stuff, then repeat. If she does this enough times, "},{"_key":"435b1ee1fd201","_type":"span","marks":["em"],"text":"she will eventually find ways of working around these tests."}],"markDefs":[],"style":"normal"},{"_key":"c009c4991526","_type":"block","children":[{"_key":"2b6b67965da30","_type":"span","marks":["strong"],"text":"It can also get quite costly"}],"markDefs":[],"style":"normal"},{"_key":"bd9c4cd1e404","_type":"block","children":[{"_key":"6bbea1ff3faf0","_type":"span","marks":[],"text":"Performing a full integration test within a sandbox implies that you mirror your entire infrastructure (albeit at a smaller scale with smaller compute sizes and dependencies) for a short time. Doing this to confirm simple changes can add up, especially if that mirror is sufficiently large.\n\nThis isn't as much of a concern for those running their platforms on bare metal, as one can apply their Terraform configurations against cold hardware and wipe as part of your "},{"_key":"6bbea1ff3faf1","_type":"span","marks":["em"],"text":"terraform destroy"},{"_key":"6bbea1ff3faf2","_type":"span","marks":[],"text":". However, this feeds into the last point, as wiping and staging for your next test run can take some time."}],"markDefs":[],"style":"normal"},{"_key":"c63781753a1c","_type":"block","children":[{"_key":"40c5fd66e0970","_type":"span","marks":["strong"],"text":"Obtaining code coverage is hard"}],"markDefs":[],"style":"normal"},{"_key":"14b20f265dc1","_type":"block","children":[{"_key":"2801721c84fb0","_type":"span","marks":[],"text":"Unlike most programming languages or mature configuration management frameworks "},{"_key":"2801721c84fb1","_type":"span","marks":["b1062c35b2f8"],"text":"like Chef"},{"_key":"2801721c84fb2","_type":"span","marks":[],"text":", Terraform doesn't yet have a framework for obtaining a percentage of configurations that have a matching integration test. This means that teams that choose to embark on this journey need to be fastidious about maintaining a high bar for code coverage and will likely write tools themselves that can do this (such as scanning all module references and looking for a matching "},{"_key":"2801721c84fb3","_type":"span","marks":["em"],"text":"spec"},{"_key":"2801721c84fb4","_type":"span","marks":[],"text":" definition)."}],"markDefs":[{"_key":"b1062c35b2f8","_type":"link","href":"https://github.com/chefspec/chefspec"}],"style":"normal"},{"_key":"936423212f3e","_type":"block","children":[{"_key":"10585f969b330","_type":"span","marks":[],"text":"Tools"}],"markDefs":[],"style":"h3"},{"_key":"52c55d952820","_type":"block","children":[{"_key":"3fb63ac607850","_type":"span","marks":["11d8ea81ee20"],"text":"kitchen-terraform"},{"_key":"3fb63ac607851","_type":"span","marks":[],"text":" is the most popular integration testing framework for Terraform at the moment. This is the same Kitchen that you might have used with Chef, and like Chef's test-kitchen, you can define how terraform should behave with "},{"_key":"3fb63ac607852","_type":"span","marks":["em"],"text":".kitchen.yml"},{"_key":"3fb63ac607853","_type":"span","marks":[],"text":" and have kitchen take care of the rest."}],"markDefs":[{"_key":"11d8ea81ee20","_type":"link","href":"https://github.com/newcontext-oss/kitchen-terraform"}],"style":"normal"},{"_key":"c94f03ded325","_type":"block","children":[{"_key":"24922ec6d0b40","_type":"span","marks":["0dd59553c21b"],"text":"Goss"},{"_key":"24922ec6d0b41","_type":"span","marks":[],"text":" is a simple validation/health-check framework that lets you define what a system should look like and either validates against that definition or provides an endpoint, "},{"_key":"24922ec6d0b42","_type":"span","marks":["em"],"text":"/health"},{"_key":"24922ec6d0b43","_type":"span","marks":[],"text":", that tells you whether that system is passing or failing to meet it. It is heavily inspired by "},{"_key":"24922ec6d0b44","_type":"span","marks":["8d59f59c4dae"],"text":"serverspec"},{"_key":"24922ec6d0b45","_type":"span","marks":[],"text":", which accomplishes much the same thing (except the cool health-check webserver) and works seamlessly with Ruby."}],"markDefs":[{"_key":"0dd59553c21b","_type":"link","href":"https://github.com/aelsabbahy/goss"},{"_key":"8d59f59c4dae","_type":"link","href":"https://github.com/mizzy/serverspec"}],"style":"normal"},{"_key":"7a65b5832d69","_type":"block","children":[{"_key":"8ee32a8d02d50","_type":"span","marks":[],"text":"Terraform Testing Strategy #3: Unit Tests"}],"markDefs":[],"style":"h2"},{"_key":"ad1fe74252a8","_type":"block","children":[{"_key":"cc3240a70b1f","_type":"span","marks":[],"text":""}],"markDefs":[],"style":"normal"},{"_key":"42a567f7810e","_type":"imageArticle","asset":{"_id":"image-b1429cf9aa982b3a8b38481f80f11abbbe63e4f9-500x326-jpg","_type":"sanity.imageAsset","_rev":"2jL4beAYAvILht20WpBbkK","_createdAt":"2020-09-17T17:26:41Z","_updatedAt":"2020-09-17T17:26:41Z","assetId":"b1429cf9aa982b3a8b38481f80f11abbbe63e4f9","extension":"jpg","metadata":{"_type":"sanity.imageMetadata","dimensions":{"_type":"sanity.imageDimensions","aspectRatio":1.5337423312883436,"height":326,"width":500},"hasAlpha":false,"isOpaque":true,"lqip":"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAUGA//EACMQAAEDAwQCAwAAAAAAAAAAAAIBAwUABAYREiExB0ETFSL/xAAWAQEBAQAAAAAAAAAAAAAAAAAFAAT/xAAbEQEAAwEAAwAAAAAAAAAAAAABAAIRAyFBcf/aAAwDAQACEQMRAD8A2hsSxS7h46bkre4ffkG0dVN3CL7SqfHhxtt0LaxhDFPmEFQiRO/dIvFVo1OeM4UL7cqNISDtLT3T10o/HSU7ePR0xXdqbq91mcPHokO/ZMZvljUBlF/HvWRmjbmoKK8bV6opJll595OP3zzQgbmn5TnSiiL9KFkwiVeag7P/2Q==","palette":{"_type":"sanity.imagePalette","darkMuted":{"_type":"sanity.imagePaletteSwatch","background":"#4b4b3a","foreground":"#fff","population":1.8,"title":"#fff"},"darkVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#745926","foreground":"#fff","population":5.89,"title":"#fff"},"dominant":{"_type":"sanity.imagePaletteSwatch","background":"#c1c9b8","foreground":"#000","population":6.57,"title":"#fff"},"lightMuted":{"_type":"sanity.imagePaletteSwatch","background":"#c1c9b8","foreground":"#000","population":6.57,"title":"#fff"},"lightVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#f6f3df","foreground":"#000","population":1.2,"title":"#000"},"muted":{"_type":"sanity.imagePaletteSwatch","background":"#ab9e7a","foreground":"#000","population":1.9,"title":"#fff"},"vibrant":{"_type":"sanity.imagePaletteSwatch","background":"#b59a59","foreground":"#000","population":2.68,"title":"#fff"}}},"mimeType":"image/jpeg","originalFilename":"Testing-in-Progress_f5a6d79dc87fc33a0ae83847f66b65e8[1].jpg","path":"images/hgftikht/production/b1429cf9aa982b3a8b38481f80f11abbbe63e4f9-500x326.jpg","sha1hash":"b1429cf9aa982b3a8b38481f80f11abbbe63e4f9","size":45048,"uploadId":"QIkxDsTSsrWYSsOpeVpPl7z2hSBogKsA","url":"https://cdn.sanity.io/images/hgftikht/production/b1429cf9aa982b3a8b38481f80f11abbbe63e4f9-500x326.jpg","id":"image-b1429cf9aa982b3a8b38481f80f11abbbe63e4f9-500x326-jpg","parent":null,"children":["b7379ffb-4e44-5a8a-b735-bea0f5cc4a15"],"internal":{"type":"SanityImageAsset","contentDigest":"b7293827c6f62a570a0455b32db604d9","counter":2680,"owner":"gatsby-source-sanity"}}},{"_key":"76cf12120941","_type":"block","children":[{"_key":"08015b5babf1","_type":"span","marks":[],"text":"If you're a software developer on a Platform or Infrastructure team and are wondering \"Well, I would usually write unit tests before writing integration tests. Is that a thing with Terraform?\", thanks for reading this far!"}],"markDefs":[],"style":"normal"},{"_key":"a0863ddb79e9","_type":"block","children":[{"_key":"741fdc0d46310","_type":"span","marks":[],"text":"As said before, integration testing enables you to test interactions between components in an entire system. "},{"_key":"741fdc0d46311","_type":"span","marks":["em"],"text":"Unit testing"},{"_key":"741fdc0d46312","_type":"span","marks":[],"text":", on the other hand, enables you to test those individual components in isolation. They are meant to be quick, easy to read and easy to write. To that end, good unit tests can be run from anywhere, with "},{"_key":"741fdc0d46313","_type":"span","marks":["em"],"text":"or without"},{"_key":"741fdc0d46314","_type":"span","marks":[],"text":" a network connection."}],"markDefs":[],"style":"normal"},{"_key":"6cfbb999c088","_type":"block","children":[{"_key":"9cfb8441bc6f0","_type":"span","marks":[],"text":"Continuing with our Kubernetes cluster example, here is what a simple unit test suite would look like for our resources defined above with "},{"_key":"9cfb8441bc6f1","_type":"span","marks":["e2916f5fcc3a"],"text":"RSpec"},{"_key":"9cfb8441bc6f2","_type":"span","marks":[],"text":", a popular testing framework for Ruby:"}],"markDefs":[{"_key":"e2916f5fcc3a","_type":"link","href":"https://github.com/rspec/rspec"}],"style":"normal"},{"_key":"8e3407dda074","_type":"block","children":[{"_key":"c3daec1b080a0","_type":"span","marks":["strong","em"],"text":"# spec/infrastructure/core/kubernetes_cluster_spec.rb"},{"_key":"3bbb060b2df7","_type":"span","marks":["em"],"text":" \nrequire 'spec_helper' \nrequire 'set' \n\ndescribe \"KubernetesCluster\" do \n  before(:all) do \n    @vpc_details = $terraform_plan['aws_vpc.infrastructure'] \n    @controllers_found = \n      $terraform_plan['kubernetes-cluster'].select do |key,value| \n        key.match /aws_instance\\.kubernetes_controller/ \n      end \n   @coreos_amis = obtain_latest_coreos_version_and_ami! \nend \n  context \"Controller\" do \n    context \"Metadata\" do \n      it \"should have retrieved EC2 details\" do \n        expect(@controllers_found).not_to be_nil \n      end \n    end \n\n    context \"Sizing\" do \n      it \"should be defined\" do \n\nexpect($terraform_tfvars['kubernetes_controller_count']).not_to be_nil \n      end \n\n      it \"should be replicated the correct number of times\" do \n        expected_number_of_kube_controllers = \\ \n          $terraform_tfvars['kubernetes_controller_count'].to_i \n        expect(@controllers_found.count).to eq \nexpected_number_of_kube_controllers \nend \n\n      it \"should use the same AZ across all Kubernetes controllers\" do \n\n# We aren't testing that these controllers actually have AZs \n# (it can be empty if not defined). We're solely testing that \n# they are the same within this AZ. \n\nazs_for_each_controller = @controllers_found.values.map do |controller_config|                       controller_config['availability_zone'] \n      end \n      deduplicated_az_set = Set.new(azs_for_each_controller) \n      expect(deduplicated_az_set.count).to eq 1 \n   end \n  end \n\nit \"should be fetching the latest stable release of CoreOS for region \\ \n\n#{ENV['AWS_REGION']}\" do \n@controllers_found.keys.each do |kube_controller_resource_name| \n    this_controller_details = \n      @controllers_found[kube_controller_resource_name] \n    expected_ami_id = @coreos_amis[ENV['AWS_REGION']]['hvm'] \n    actual_ami_id = this_controller_details['ami'] \n    expect(expected_ami_id).to eq \n    expected_ami_id \n  end \nend \n\nit \"should use the instance size requested\" do \n  @controllers_found.keys.each do |kube_controller_resource_name| \n    this_controller_details = \n      @controllers_found[kube_controller_resource_name] \n    actual_instance_size = \nthis_controller_details['instance_type'] \n    expected_instance_size = \n      $terraform_tfvars['kubernetes_controller_instance_size'] \n    expect(expected_instance_size).to eq \n    actual_instance_size \n  end \nend \n\nit \"should use the key provided\" do \n    @controllers_found.keys.each do |kube_controller_resource_name| \n    this_controller_details = \n      @controllers_found[kube_controller_resource_name] \nactual_ec2_instance_key_name = \nthis_controller_details['key_name'] \nexpected_ec2_instance_key_name = \n\n$terraform_tfvars['kubernetes_controller_ec2_instance_key_name']       expect(expected_ec2_instance_key_name).to eq \nactual_ec2_instance_key_name \n        end \n      end \n  end \nend"}],"markDefs":[],"style":"normal"},{"_key":"1ec7181805b2","_type":"block","children":[{"_key":"8a79f65e0d3c0","_type":"span","marks":[],"text":"There are a few notable things to point out with this test:"}],"markDefs":[],"style":"normal"},{"_key":"35c7a6d7f445","_type":"block","children":[{"_key":"3af8a7dbe8a20","_type":"span","marks":["strong"],"text":"It’s easy to read"}],"markDefs":[],"style":"normal"},{"_key":"6fa5d31be188","_type":"block","children":[{"_key":"d88b146f4e630","_type":"span","marks":[],"text":"We use natural English-like statements to express what the test is, what it's doing and what it should do. If we read this snippet from the above...\n"}],"markDefs":[],"style":"normal"},{"_key":"e38a48211111","_type":"block","children":[{"_key":"586826578eee0","_type":"span","marks":["em"],"text":"describe \"KubernetesCluster\" do \n  before(:all) do \n    @vpc_details = $terraform_plan['aws_vpc.infrastructure'] \n    @controllers_found = \n      $terraform_plan['kubernetes-cluster'].select do |key,value| \n        key.match /aws_instance\\.kubernetes_controller/ \n      end \n    @coreos_amis = obtain_latest_coreos_version_and_ami! \nend \ncontext \"Controller\" do \n  context \"Metadata\" do \n    it \"should have retrieved EC2 details\" do \n        expect(@controllers_found).not_to be_nil \n    end \n  end"}],"markDefs":[],"style":"normal"},{"_key":"29f5adb2e0d7","_type":"block","children":[{"_key":"b38360d30e270","_type":"span","marks":[],"text":"...we can see that we're "},{"_key":"b38360d30e271","_type":"span","marks":["strong"],"text":"describing"},{"_key":"b38360d30e272","_type":"span","marks":[],"text":" our Kubernetes cluster, executing some statements "},{"_key":"b38360d30e273","_type":"span","marks":["strong"],"text":"before all"},{"_key":"b38360d30e274","_type":"span","marks":[],"text":" other tests run, then running a series of "},{"_key":"b38360d30e275","_type":"span","marks":["strong"],"text":"controller-"},{"_key":"b38360d30e276","_type":"span","marks":[],"text":"related tests, with this test focussing on "},{"_key":"b38360d30e277","_type":"span","marks":["strong"],"text":"metadata"},{"_key":"b38360d30e278","_type":"span","marks":[],"text":" belonging to that Kubernetes controller. We're expecting that "},{"_key":"b38360d30e279","_type":"span","marks":["strong"],"text":"it should have receive details from EC2,"},{"_key":"b38360d30e2710","_type":"span","marks":[],"text":" and that those details are an array of "},{"_key":"b38360d30e2711","_type":"span","marks":["strong"],"text":"controllers found"},{"_key":"b38360d30e2712","_type":"span","marks":[],"text":"."}],"markDefs":[],"style":"normal"},{"_key":"97e30b9238da","_type":"block","children":[{"_key":"ab064f0fa7590","_type":"span","marks":["strong"],"text":"It’s quick"}],"markDefs":[],"style":"normal"},{"_key":"03034fc8ae56","_type":"block","children":[{"_key":"e5b64aee7c790","_type":"span","marks":[],"text":"Once we generate our Terraform plan (more on how to do this soon), this test runs in less than a second. There is no sandbox to query or AWS API calls to make; we're simply comparing what we wrote against what Terraform generated from that.\n"}],"markDefs":[],"style":"normal"},{"_key":"70d148c1d3f7","_type":"block","children":[{"_key":"279210e251450","_type":"span","marks":["strong"],"text":"It’s easy to write"}],"markDefs":[],"style":"normal"},{"_key":"57f0c82e1be0","_type":"block","children":[{"_key":"9f05c147911e0","_type":"span","marks":[],"text":"With a few caveats (see the "},{"_key":"9f05c147911e1","_type":"span","marks":["em"],"text":"Disadvantages"},{"_key":"9f05c147911e2","_type":"span","marks":[],"text":" section), all of these test examples are straight from RSpec's documentation "},{"_key":"9f05c147911e3","_type":"span","marks":["df6f4f2fbf55"],"text":"here"},{"_key":"9f05c147911e4","_type":"span","marks":[],"text":". There's no hidden methods or deeply-nested pitfalls unless you defined them explicitly beforehand."}],"markDefs":[{"_key":"df6f4f2fbf55","_type":"link","href":"https://relishapp.com/rspec/rspec-core/v/3-4/docs"}],"style":"normal"},{"_key":"87924db07e58","_type":"block","children":[{"_key":"a41e0bbe32be0","_type":"span","marks":[],"text":"So why should we unit test Terraform code?"}],"markDefs":[],"style":"normal"},{"_key":"f26e77bae3f3","_type":"block","children":[{"_key":"815cbc38e41c0","_type":"span","marks":[],"text":"Advantages"}],"markDefs":[],"style":"h3"},{"_key":"f8ccef952ab9","_type":"block","children":[{"_key":"e5b3db731f0f0","_type":"span","marks":["strong"],"text":"It enables test-driven development"}],"markDefs":[],"style":"normal"},{"_key":"1881a4b75eb2","_type":"block","children":[{"_key":"d8c320dd9fc10","_type":"span","marks":["5d7968bc8540"],"text":"Test-driven development"},{"_key":"d8c320dd9fc11","_type":"span","marks":[],"text":" is a software development pattern whereby every method in a feature is written "},{"_key":"d8c320dd9fc12","_type":"span","marks":["em"],"text":"after"},{"_key":"d8c320dd9fc13","_type":"span","marks":[],"text":" writing a test describing what that feature is expected to do. This ensures that every method that does something impactful has a test describing it. "},{"_key":"d8c320dd9fc14","_type":"span","marks":["strong"],"text":"This is only possible if your unit tests are quick"},{"_key":"d8c320dd9fc15","_type":"span","marks":[],"text":", as the feedback loop between running the test and writing code that makes it pass has to be quick, usually on the order of a few seconds.\n\nWhat this means for Terraform configuration is that I can write something like this...\n"}],"markDefs":[{"_key":"5d7968bc8540","_type":"link","href":"https://medium.com/@fagnerbrack/why-test-driven-development-4fb92d56487c"}],"style":"normal"},{"_key":"fee319f10e57","_type":"block","children":[{"_key":"45f4096eb9da0","_type":"span","marks":["em"],"text":"describe \"VPC\" do \n    context \"Networking\" do \n      it \"should use the right CIDR\" do \n        expected_cidr_block = $terraform_tfvars['cidr_block'] \n        expect($terraform_plan['aws_vpc.vpc']['cidr_block']).to eq expected_cidr_block \n      end \n    end \n  end"}],"markDefs":[],"style":"normal"},{"_key":"fd1720e86871","_type":"block","children":[{"_key":"c896e0a1d1270","_type":"span","marks":[],"text":"...before I lay down my "},{"_key":"c896e0a1d1271","_type":"span","marks":["em"],"text":"main.tf"},{"_key":"c896e0a1d1272","_type":"span","marks":[],"text":", run "},{"_key":"c896e0a1d1273","_type":"span","marks":["em"],"text":"rake unit_test"},{"_key":"c896e0a1d1274","_type":"span","marks":[],"text":" (or similar) to see it fail, then continue writing my main.tf until this test passes. Without even thinking about it, I (a) documented my infrastructure and (b) documented \"what good looks like\" in this context."}],"markDefs":[],"style":"normal"},{"_key":"3d080e31acc4","_type":"block","children":[{"_key":"c8c1e159ebb60","_type":"span","marks":["strong"],"text":"Faster than integration tests"}],"markDefs":[],"style":"normal"},{"_key":"b3e775c15e5c","_type":"block","children":[{"_key":"fd05b8f6d5af0","_type":"span","marks":[],"text":"Terraform unit tests work entirely off of your calculated Terraform plan. No additional compute is required to run them. This means that you'll catch errors in your Terraform code earlier and more often before spending money on a sandboxed testing environment.\n"}],"markDefs":[],"style":"normal"},{"_key":"575f6421b3f0","_type":"block","children":[{"_key":"cc93ef8ac3720","_type":"span","marks":["strong"],"text":"Smaller than integration tests"}],"markDefs":[],"style":"normal"},{"_key":"6d8da650762f","_type":"block","children":[{"_key":"723039d8ba330","_type":"span","marks":[],"text":"Because unit tests only focus on a single implementational detail (such as ensuring that your VPC CIDR is correct or that your AWS security group is to specification), they enable you to write "},{"_key":"723039d8ba331","_type":"span","marks":["em"],"text":"more"},{"_key":"723039d8ba332","_type":"span","marks":[],"text":" of them. When combined with the integration tests described in the previous section, this "},{"_key":"723039d8ba333","_type":"span","marks":["181151b93076"],"text":"testing framework"},{"_key":"723039d8ba334","_type":"span","marks":[],"text":" makes for a very robust platform that can significantly mitigate opportunities for human error."}],"markDefs":[{"_key":"181151b93076","_type":"link","href":"http://www.contino.io/insights/the-testing-pyramid"}],"style":"normal"},{"_key":"00ab9d0b2e27","_type":"block","children":[{"_key":"b0109aa019e60","_type":"span","marks":[],"text":"Disadvantages"}],"markDefs":[],"style":"h3"},{"_key":"b7eb95614b1c","_type":"block","children":[{"_key":"c09abde864db0","_type":"span","marks":[],"text":"To be clear, "},{"_key":"c09abde864db1","_type":"span","marks":["strong"],"text":"unit tests complement integration tests. They do not replace them."},{"_key":"c09abde864db2","_type":"span","marks":[],"text":" They also come with their own disadvantages:"}],"markDefs":[],"style":"normal"},{"_key":"586eacf36a95","_type":"block","children":[{"_key":"6ba8c97a8d360","_type":"span","marks":["strong"],"text":"There are very, very few tools for reliably unit testing Terraform"}],"markDefs":[],"style":"normal"},{"_key":"d4cc3137c1a1","_type":"block","children":[{"_key":"3726732b5c280","_type":"span","marks":[],"text":"As you'll see in the ‘tools’ section below, there aren't very many out-of-the-box options available for doing this. Consequently, this means that you will most likely need to roll-your-own solution.\n"}],"markDefs":[],"style":"normal"},{"_key":"166b7ae1734c","_type":"block","children":[{"_key":"b08d3344e0500","_type":"span","marks":["strong"],"text":"TDD is slower at first than just writing code"}],"markDefs":[],"style":"normal"},{"_key":"45034d2d9a04","_type":"block","children":[{"_key":"65228ac108e50","_type":"span","marks":[],"text":"Many software developers are familiar with writing code first and testing later. Fewer, but an increasing amount, are more acquainted with writing failing tests first and making them pass with code. Making the transition can feel like a fruitless exercise, as one can spend a lot of time writing a working test (especially in the absence of a good testing framework) or writing a "},{"_key":"65228ac108e51","_type":"span","marks":["em"],"text":"valid"},{"_key":"65228ac108e52","_type":"span","marks":[],"text":" test.\n\nThe rub in this perceived lag is that the time spent on ensuring that your Terraform code works right from the start "},{"_key":"65228ac108e53","_type":"span","marks":["em"],"text":"and works as it should"},{"_key":"65228ac108e54","_type":"span","marks":[],"text":" is a savings in comparison to debugging complicated Terraform resource relationships later on. Instilling a test-first culture goes a long way in simplifying complex code in the long term.\n"}],"markDefs":[],"style":"normal"},{"_key":"97fc666e373e","_type":"block","children":[{"_key":"5df60b948aad0","_type":"span","marks":["strong"],"text":"Learning curve for first-time infrastructure developers can be high"}],"markDefs":[],"style":"normal"},{"_key":"ee70b428ff56","_type":"block","children":[{"_key":"f42e73bade1f0","_type":"span","marks":[],"text":"If you're like me, you came into Infrastructure and the DevOps mindset as a systems administrator. Tools with high-level languages like Chef and Terraform have helped make this transition easier. However, given the lack of good Terraform unit test tooling, some underlying knowledge of a programming language is required. My solution uses a good amount of Ruby, for example. While "},{"_key":"f42e73bade1f1","_type":"span","marks":["48e9102c1fd3"],"text":"mature infrastructure teams should optimize for having a strong programming background"},{"_key":"f42e73bade1f2","_type":"span","marks":[],"text":", this can be a little daunting to those that are just getting into this."}],"markDefs":[{"_key":"48e9102c1fd3","_type":"link","href":"https://www.linkedin.com/pulse/getting-devops-carlos-nunez"}],"style":"normal"},{"_key":"623aac220672","_type":"block","children":[{"_key":"3d563b1ff4530","_type":"span","marks":[],"text":"Tools (or lack thereof)"}],"markDefs":[],"style":"h3"},{"_key":"827b356a7eef","_type":"block","children":[{"_key":"2e663eac2ea10","_type":"span","marks":[],"text":"Unit testing Terraform is still in early days. Nevertheless, there are some options available for those looking to pursue this.\n"}],"markDefs":[],"style":"normal"},{"_key":"68385e558254","_type":"block","children":[{"_key":"80e6e62031020","_type":"span","marks":["strong","9037d6fdecc2"],"text":"My Infrastructure Example"},{"_key":"67e942f8f82b","_type":"span","marks":[],"text":"​ "}],"markDefs":[{"_key":"9037d6fdecc2","_type":"link","href":"https://github.com/carlosonunez/infrastructure"}],"style":"normal"},{"_key":"237075b857d5","_type":"block","children":[{"_key":"8147aef367ed0","_type":"span","marks":[],"text":"I use unit testing heavily for deploying my infrastructure. While it's still a work in progress, I'm aiming for Terraform code that can provision a VPC, a five node Kubernetes cluster (three masters, two workers) and a Route53 zone. This will ultimately be used to host my "},{"_key":"8147aef367ed1","_type":"span","marks":["6024df986127"],"text":"blog"},{"_key":"8147aef367ed2","_type":"span","marks":[],"text":", "},{"_key":"8147aef367ed3","_type":"span","marks":["084a9f38491e"],"text":"personal website"},{"_key":"8147aef367ed4","_type":"span","marks":[],"text":" and tools that I've been long procrastinating on. I am using RSpec to do this and am aiming for a provider-dependent approach (i.e. something that you can use to test AWS resources just as well as OpenStack resources).\n\nThe area to focus on is the "},{"_key":"8147aef367ed5","_type":"span","marks":["em"],"text":"spec"},{"_key":"8147aef367ed6","_type":"span","marks":[],"text":" folder, namely on "},{"_key":"8147aef367ed7","_type":"span","marks":["em"],"text":"spec/spec_helper.rb"},{"_key":"8147aef367ed8","_type":"span","marks":[],"text":". This parses my Terraform variables file (which, in my Jenkins pipeline defined by "},{"_key":"8147aef367ed9","_type":"span","marks":["em"],"text":"Jenkinsfile"},{"_key":"8147aef367ed10","_type":"span","marks":[],"text":", is retrieved from S3 automatically depending on the environment being provisioned) and uses it to create a Terraform plan from a dummy state file that's written to disk. I use a dummy state file to ensure that Terraform always generates a complete plan on every test run. I figured that it makes little sense to test whether Terraform picks up changes, as accounting for this will complicate my tests and are made redundant by the testing done against Terraform itself.\n\nIf you've ever saved a "},{"_key":"8147aef367ed11","_type":"span","marks":["em"],"text":"tfplan"},{"_key":"8147aef367ed12","_type":"span","marks":[],"text":" onto disk, you know that parsing it can get complicated. The file itself is a binary file, so parsing it directly is off the table. While one can use "},{"_key":"8147aef367ed13","_type":"span","marks":["em"],"text":"terraform show"},{"_key":"8147aef367ed14","_type":"span","marks":[],"text":" to render a human-readable version of it, accounting for whitespace, multiple copies of resources, dependencies, and others makes this parsing tricky. The only tool that I could find that turned this into a common machine-readable format was "},{"_key":"8147aef367ed15","_type":"span","marks":["9ba6373f09f6"],"text":"tfjson"},{"_key":"8147aef367ed16","_type":"span","marks":[],"text":" from Palantir that, reliably, turns plans into JSON. (I tried to update its Terraform libraries to a more recent version but ran into a lot of problems. This is why my Rakefile downloads both a newer and older version of Terraform.)\n\nIf you have suggestions on how to make it better, please feel free to send me a pull request!\n"}],"markDefs":[{"_key":"6024df986127","_type":"link","href":"http://blog.carlosnunez.me/"},{"_key":"084a9f38491e","_type":"link","href":"https://carlosnunez.me/"},{"_key":"9ba6373f09f6","_type":"link","href":"https://github.com/palantir/tfjson"}],"style":"normal"},{"_key":"b1467c1e1ee2","_type":"block","children":[{"_key":"7bfdd5692e330","_type":"span","marks":["81130a719cf7"],"text":"Terraform-compliance"},{"_key":"6dba5e31c8c0","_type":"span","marks":[],"text":"​ "}],"markDefs":[{"_key":"81130a719cf7","_type":"link","href":"https://github.com/eerkunt/terraform-compliance"}],"style":"normal"},{"_key":"7d767da9f5ea","_type":"block","children":[{"_key":"d2d3dddcc94f0","_type":"span","marks":[],"text":"This tool, written by my colleague "},{"_key":"d2d3dddcc94f1","_type":"span","marks":["dbb5cdccb7e4"],"text":"Emre Erkunt"},{"_key":"d2d3dddcc94f2","_type":"span","marks":[],"text":", is another good tool for performing unit tests against Terraform code. While this aims for an even higher level of testing abstraction called "},{"_key":"d2d3dddcc94f3","_type":"span","marks":["48f626103259","strong"],"text":"business driven development"},{"_key":"d2d3dddcc94f4","_type":"span","marks":[],"text":", it can be used to write unit tests against AWS resources as well.\n"}],"markDefs":[{"_key":"dbb5cdccb7e4","_type":"link","href":"https://www.linkedin.com/in/emreerkunt/"},{"_key":"48f626103259","_type":"link","href":"https://medium.com/the-reading-room/behaviour-driven-development-a-better-agile-778d2d2a7ab5"}],"style":"normal"},{"_key":"9a1b4afaefdc","_type":"block","children":[{"_key":"86d53ffc2a5e0","_type":"span","marks":["8d56a84d8a05"],"text":"Rspec-terraform"},{"_key":"c2003681df09","_type":"span","marks":[],"text":"​ "}],"markDefs":[{"_key":"8d56a84d8a05","_type":"link","href":"https://github.com/bsnape/rspec-terraform"}],"style":"normal"},{"_key":"b0257b536bbb","_type":"block","children":[{"_key":"9d33eef269420","_type":"span","marks":[],"text":"A cleaner, AWS-specific implementation of my approach. This is another great drop-in solution to consider if you're not looking for a provider-agnostic solution."}],"markDefs":[],"style":"normal"},{"_key":"9a6fdf98cd8b","_type":"block","children":[{"_key":"488339f375e00","_type":"span","marks":[],"text":"In Conclusion: The Complete Deployment Pipeline"}],"markDefs":[],"style":"normal"},{"_key":"2d630379b0e1","_type":"block","children":[{"_key":"a7f55b23283d0","_type":"span","marks":[],"text":"Using integration and unit testing to develop and iterate your infrastructure-as-code codebase enables you to create an environment deployment pipeline that looks something like this:"}],"markDefs":[],"style":"normal"},{"_key":"63f72a517501","_type":"block","children":[{"_key":"dbf8414b67e4","_type":"span","marks":[],"text":""}],"markDefs":[],"style":"normal"},{"_key":"d67fbd105b78","_type":"imageArticle","asset":{"_id":"image-291c426fa5b3908ff9e38523131b6217554243ab-558x443-png","_type":"sanity.imageAsset","_rev":"qD2nwhohCpR7vPHyE9cGjE","_createdAt":"2020-09-17T17:25:44Z","_updatedAt":"2020-09-17T17:25:44Z","assetId":"291c426fa5b3908ff9e38523131b6217554243ab","extension":"png","metadata":{"_type":"sanity.imageMetadata","dimensions":{"_type":"sanity.imageDimensions","aspectRatio":1.2595936794582392,"height":443,"width":558},"hasAlpha":true,"isOpaque":true,"lqip":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC2ElEQVQ4y22TSY/bRhCF9asN5Jo4V/uv5BDAhmEg8dU55GRoKFJkk71xERdR+0jU86uWNMYYFlBis7rr66pXxdlms0HXdVitVmjbFk3ToKoq+no89sQnT9lv6e/74dXZuq6xXq9xuVwwG8cxbIrzcSAvNJyv0Q/r4CvLMuwb62BcjbppX0Bi3nsm1OJ8JlDINTetMTDaIM8LxEkKVTgGrWCM+HJorZFlOXLtYG2JXOUoihzOSlxBcEXgM4FtBacV0iTGYhEjisQSKKUJMvQtg2+5TIMVvFAR/DSfYzH/hjxdwKgEbW1xOW0x27QWTWlgmYEuDG9lRqqAYdlGW2ZVBLi1nvt8hqwszyholaL2Bo0vsG40pl1DYMcGtE3QShojmkiJBQO8k/IsnJPyqSEvNQSu7lqXpaf+jCkdulLhMnrMhpVD6W3QylrRS2HxNEcaRyFYZWkwo6lftoTJM1TeMVspPWMcK8uZqY4JdNSQQGdugRkPpKLVIkK+XEClS8RRRJML+L5MWDJLZQVJHCORc1lCDWN0PmPJK8x2PUtuSpZnmamMQssmsXMqu3dduquQpVnQ0xofuqwLy7VluR5N5TD2K0znI4FDjaG/zWHbdhjHDTzLMBS8qRvO2G0uC8IVu16YClXdBk1F9/4++H3fY5omalhreMsAamcJkrlSyRM0x6Hi7TJ/acpxoWYC1sywrHgRh70UKBspgy0fxw1YEaQiFMs5IVEwmz2hsSnFtwSaAHt0WqqQzI2MFiWoCZbp2G63uF6vmD3vOuzXNXZ9if1Qcd3gOLY47QYc9jvs9/tgh8MBp9MJz7Sd4+z9+w+qjx+wZsOOuy2/4+kGxHTBzc635/VhE/iHl9/1tp4I3P//H/r3f6L74zdsPv2N83q4HyHweg97ZdeHXV/ZD+BX9O/eov/9DTYf/sJ56O9xAvwp6FeQV2sK/1x5bL98xkjYIfqG6Xh8OfcdumSpbOWsEGEAAAAASUVORK5CYII=","palette":{"_type":"sanity.imagePalette","darkMuted":{"_type":"sanity.imagePaletteSwatch","background":"#474639","foreground":"#fff","population":0.06,"title":"#fff"},"darkVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#93503d","foreground":"#fff","population":0.05,"title":"#fff"},"dominant":{"_type":"sanity.imagePaletteSwatch","background":"#cdc6ba","foreground":"#000","population":3.8,"title":"#fff"},"lightMuted":{"_type":"sanity.imagePaletteSwatch","background":"#cdc6ba","foreground":"#000","population":3.8,"title":"#fff"},"lightVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#e6bc91","foreground":"#000","population":0.96,"title":"#fff"},"muted":{"_type":"sanity.imagePaletteSwatch","background":"#a56e72","foreground":"#fff","population":0.14,"title":"#fff"},"vibrant":{"_type":"sanity.imagePaletteSwatch","background":"#e43225","foreground":"#fff","population":1.37,"title":"#fff"}}},"mimeType":"image/png","originalFilename":"Terraform-Pipeline_f5a6d79dc87fc33a0ae83847f66b65e8[1].png","path":"images/hgftikht/production/291c426fa5b3908ff9e38523131b6217554243ab-558x443.png","sha1hash":"291c426fa5b3908ff9e38523131b6217554243ab","size":195328,"uploadId":"yfgt4a6fgsMRxz4huqe0odpPGTRWhl5x","url":"https://cdn.sanity.io/images/hgftikht/production/291c426fa5b3908ff9e38523131b6217554243ab-558x443.png","id":"image-291c426fa5b3908ff9e38523131b6217554243ab-558x443-png","parent":null,"children":["e51f47fe-a55a-5a51-924a-8f0474b285f8"],"internal":{"type":"SanityImageAsset","contentDigest":"4e04d15749f7848769175393e39f1ea5","counter":2677,"owner":"gatsby-source-sanity"}}},{"_key":"89e627b08238","_type":"block","children":[{"_key":"37facebfa0a5","_type":"span","marks":["strong"],"text":"Figure 2: Illustration of a complete environment deployment pipeline."}],"markDefs":[],"style":"normal"},{"_key":"a50696f9fcb8","_type":"block","children":[{"_key":"c09f8bba3fa90","_type":"span","marks":[],"text":"Unit tests are executed locally during the first stage of the pipeline. Terraform makes it easy to see what it's going to go by way of the Terraform plan. We can use this to create unit tests that test the behavior individual modules and resources and establish a contract to which they must adhere. This can be enforced further by Git or SVN commit hooks that automatically perform unit tests when creating a pull request that merges into the "},{"_key":"c09f8bba3fa91","_type":"span","marks":["em"],"text":"master"},{"_key":"c09f8bba3fa92","_type":"span","marks":[],"text":" branch."}],"markDefs":[],"style":"normal"},{"_key":"ee16e99c5c2a","_type":"block","children":[{"_key":"86de7d7c6d220","_type":"span","marks":[],"text":"Once local unit tests pass, the next stage is to execute integration tests using serverspec or kitchen-terraform. While this can be done locally on the developer's workstation, we recommend this be done on a CI server upon invocation of a pull request to guarantee that the code submitted in a pull request is passing. The integration tests will use the Terraform code and any provisioner dependencies contained therein to create an exact replica of a live environment, run tests against live instances then tear it down and report their results."}],"markDefs":[],"style":"normal"},{"_key":"23e46dc89f2b","_type":"block","children":[{"_key":"b48cf3b025d50","_type":"span","marks":[],"text":"An environment ‘release’ follows passing integration tests and merging the pull request into master. Because your Terraform configurations have already been tested locally and through CI, the ‘release’ is as straightforward as tagging the merging commit with a version number and using a deployment strategy to move inbound traffic away from the old environment and into the new environment. Depending on the application and its usage, this might involve re-pointing your DNS records and load balancers to reference the new environment version instead of the old environment version (also known as blue-green deployment) or redirecting traffic slowly from the old environment onto the new environment (also known as a canary deployment - with the new environment being the canary)."}],"markDefs":[],"style":"normal"},{"_key":"cb82659c5143","_type":"block","children":[{"_key":"03225238d2410","_type":"span","marks":[],"text":"Following this approach will enable your team to update your Infrastructure more reliably, fall back to a known working version more quickly and iterate new features and developments with significantly more confidence."}],"markDefs":[],"style":"normal"}],"author":{"name":"Carlos Nunez","image":{"alt":"Carlos Nunez","asset":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAQABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAYHCP/EACIQAAEDBAICAwAAAAAAAAAAAAECAwQABQYRBxJRYSExQf/EABcBAAMBAAAAAAAAAAAAAAAAAAECAwT/xAAZEQADAQEBAAAAAAAAAAAAAAAAAQIDITH/2gAMAwEAAhEDEQA/ALdk8pyLY33GO3b4G0/YFIuE3R85s5GYVIMRxkqWlw7CVeaTOa+RrhAu6rDbylpkJSXlkbKt/lT/AB3k6bY8rE5DSHopQGnEga7J8j3RrK3oqXg8awsqlrpr5xQ7UUu2TIIt9tce4Ql9mXk7Hr1RVjMf/9k=","aspectRatio":1.25,"src":"https://cdn.sanity.io/images/hgftikht/production/e3c77a443c38f448b1834df6d91659509140abe0-5020x4016.jpg?w=80&h=64&fit=crop","srcSet":"https://cdn.sanity.io/images/hgftikht/production/e3c77a443c38f448b1834df6d91659509140abe0-5020x4016.jpg?w=120&h=96&fit=crop 120w,\nhttps://cdn.sanity.io/images/hgftikht/production/e3c77a443c38f448b1834df6d91659509140abe0-5020x4016.jpg?w=160&h=128&fit=crop 160w,\nhttps://cdn.sanity.io/images/hgftikht/production/e3c77a443c38f448b1834df6d91659509140abe0-5020x4016.jpg?w=240&h=192&fit=crop 240w,\nhttps://cdn.sanity.io/images/hgftikht/production/e3c77a443c38f448b1834df6d91659509140abe0-5020x4016.jpg 5020w","srcWebp":"https://cdn.sanity.io/images/hgftikht/production/e3c77a443c38f448b1834df6d91659509140abe0-5020x4016.jpg?w=80&h=64&fit=crop&fm=webp","srcSetWebp":"https://cdn.sanity.io/images/hgftikht/production/e3c77a443c38f448b1834df6d91659509140abe0-5020x4016.jpg?w=120&h=96&fit=crop&fm=webp 120w,\nhttps://cdn.sanity.io/images/hgftikht/production/e3c77a443c38f448b1834df6d91659509140abe0-5020x4016.jpg?w=160&h=128&fit=crop&fm=webp 160w,\nhttps://cdn.sanity.io/images/hgftikht/production/e3c77a443c38f448b1834df6d91659509140abe0-5020x4016.jpg?w=240&h=192&fit=crop&fm=webp 240w,\nhttps://cdn.sanity.io/images/hgftikht/production/e3c77a443c38f448b1834df6d91659509140abe0-5020x4016.jpg?fm=webp 5020w","sizes":"(max-width: 80px) 100vw, 80px"}}}}},"moreArticles":[{"title":"Why Is It Hard to Innovate in the Public Sector and What Can We Do?","slug":{"current":"why-is-it-hard-to-innovate-in-the-public-sector-and-what-can-we-do"},"publishedAt":"27 June 2017","heroImage":{"alt":"Why Is It Hard to Innovate in the Public Sector and What Can We Do?","asset":{"fluid":{"aspectRatio":1.4754098360655739,"src":"https://cdn.sanity.io/images/hgftikht/production/b0f1fc21f2d259506dbec5412793f766b0fd5837-1000x666.jpg?w=630&h=427&fit=crop","srcSet":"https://cdn.sanity.io/images/hgftikht/production/b0f1fc21f2d259506dbec5412793f766b0fd5837-1000x666.jpg?w=158&h=107&fit=crop 158w,\nhttps://cdn.sanity.io/images/hgftikht/production/b0f1fc21f2d259506dbec5412793f766b0fd5837-1000x666.jpg?w=315&h=214&fit=crop 315w,\nhttps://cdn.sanity.io/images/hgftikht/production/b0f1fc21f2d259506dbec5412793f766b0fd5837-1000x666.jpg?w=630&h=427&fit=crop 630w,\nhttps://cdn.sanity.io/images/hgftikht/production/b0f1fc21f2d259506dbec5412793f766b0fd5837-1000x666.jpg?w=945&h=641&fit=crop 945w,\nhttps://cdn.sanity.io/images/hgftikht/production/b0f1fc21f2d259506dbec5412793f766b0fd5837-1000x666.jpg?w=1000&h=678&fit=crop 1000w","srcWebp":"https://cdn.sanity.io/images/hgftikht/production/b0f1fc21f2d259506dbec5412793f766b0fd5837-1000x666.jpg?w=630&h=427&fit=crop&fm=webp","srcSetWebp":"https://cdn.sanity.io/images/hgftikht/production/b0f1fc21f2d259506dbec5412793f766b0fd5837-1000x666.jpg?w=158&h=107&fit=crop&fm=webp 158w,\nhttps://cdn.sanity.io/images/hgftikht/production/b0f1fc21f2d259506dbec5412793f766b0fd5837-1000x666.jpg?w=315&h=214&fit=crop&fm=webp 315w,\nhttps://cdn.sanity.io/images/hgftikht/production/b0f1fc21f2d259506dbec5412793f766b0fd5837-1000x666.jpg?w=630&h=427&fit=crop&fm=webp 630w,\nhttps://cdn.sanity.io/images/hgftikht/production/b0f1fc21f2d259506dbec5412793f766b0fd5837-1000x666.jpg?w=945&h=641&fit=crop&fm=webp 945w,\nhttps://cdn.sanity.io/images/hgftikht/production/b0f1fc21f2d259506dbec5412793f766b0fd5837-1000x666.jpg?w=1000&h=678&fit=crop&fm=webp 1000w","sizes":"(max-width: 630px) 100vw, 630px"}}},"author":{"name":"Alistair Smith","image":null}},{"title":"Why Enterprise Development Is Slow","slug":{"current":"why-enterprise-development-is-slow"},"publishedAt":"22 June 2017","heroImage":{"alt":"Why Enterprise Development Is Slow","asset":{"fluid":{"aspectRatio":1.4754098360655739,"src":"https://cdn.sanity.io/images/hgftikht/production/0e0efb801ebe21fd90d43ac8db1308c60ffcab23-1000x666.jpg?w=630&h=427&fit=crop","srcSet":"https://cdn.sanity.io/images/hgftikht/production/0e0efb801ebe21fd90d43ac8db1308c60ffcab23-1000x666.jpg?w=158&h=107&fit=crop 158w,\nhttps://cdn.sanity.io/images/hgftikht/production/0e0efb801ebe21fd90d43ac8db1308c60ffcab23-1000x666.jpg?w=315&h=214&fit=crop 315w,\nhttps://cdn.sanity.io/images/hgftikht/production/0e0efb801ebe21fd90d43ac8db1308c60ffcab23-1000x666.jpg?w=630&h=427&fit=crop 630w,\nhttps://cdn.sanity.io/images/hgftikht/production/0e0efb801ebe21fd90d43ac8db1308c60ffcab23-1000x666.jpg?w=945&h=641&fit=crop 945w,\nhttps://cdn.sanity.io/images/hgftikht/production/0e0efb801ebe21fd90d43ac8db1308c60ffcab23-1000x666.jpg?w=1000&h=678&fit=crop 1000w","srcWebp":"https://cdn.sanity.io/images/hgftikht/production/0e0efb801ebe21fd90d43ac8db1308c60ffcab23-1000x666.jpg?w=630&h=427&fit=crop&fm=webp","srcSetWebp":"https://cdn.sanity.io/images/hgftikht/production/0e0efb801ebe21fd90d43ac8db1308c60ffcab23-1000x666.jpg?w=158&h=107&fit=crop&fm=webp 158w,\nhttps://cdn.sanity.io/images/hgftikht/production/0e0efb801ebe21fd90d43ac8db1308c60ffcab23-1000x666.jpg?w=315&h=214&fit=crop&fm=webp 315w,\nhttps://cdn.sanity.io/images/hgftikht/production/0e0efb801ebe21fd90d43ac8db1308c60ffcab23-1000x666.jpg?w=630&h=427&fit=crop&fm=webp 630w,\nhttps://cdn.sanity.io/images/hgftikht/production/0e0efb801ebe21fd90d43ac8db1308c60ffcab23-1000x666.jpg?w=945&h=641&fit=crop&fm=webp 945w,\nhttps://cdn.sanity.io/images/hgftikht/production/0e0efb801ebe21fd90d43ac8db1308c60ffcab23-1000x666.jpg?w=1000&h=678&fit=crop&fm=webp 1000w","sizes":"(max-width: 630px) 100vw, 630px"}}},"author":{"name":"Benjamin Wootton","image":{"alt":"Benjamin Wootton","asset":{"fluid":{"base64":"data:image/png;base64,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","aspectRatio":1,"src":"https://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?w=80&h=80&fit=crop","srcSet":"https://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?w=120&h=120&fit=crop 120w,\nhttps://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?w=160&h=160&fit=crop 160w,\nhttps://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?w=240&h=240&fit=crop 240w,\nhttps://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png 420w","srcWebp":"https://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?w=80&h=80&fit=crop&fm=webp","srcSetWebp":"https://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?w=120&h=120&fit=crop&fm=webp 120w,\nhttps://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?w=160&h=160&fit=crop&fm=webp 160w,\nhttps://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?w=240&h=240&fit=crop&fm=webp 240w,\nhttps://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?fm=webp 420w","sizes":"(max-width: 80px) 100vw, 80px"}}}}},{"title":"The Lift-and-Shift Fallacy: Why It Will Cost You Time, Money and People","slug":{"current":"the-lift-and-shift-fallacy-why-it-will-cost-you-time-money-and-people"},"publishedAt":"20 June 2017","heroImage":{"alt":"The Lift-and-Shift Fallacy: Why It Will Cost You Time, Money and People","asset":{"fluid":{"aspectRatio":1.4754098360655739,"src":"https://cdn.sanity.io/images/hgftikht/production/a4d5add174c8c677f5590bd7174a79c9da99f111-1000x666.jpg?w=630&h=427&fit=crop","srcSet":"https://cdn.sanity.io/images/hgftikht/production/a4d5add174c8c677f5590bd7174a79c9da99f111-1000x666.jpg?w=158&h=107&fit=crop 158w,\nhttps://cdn.sanity.io/images/hgftikht/production/a4d5add174c8c677f5590bd7174a79c9da99f111-1000x666.jpg?w=315&h=214&fit=crop 315w,\nhttps://cdn.sanity.io/images/hgftikht/production/a4d5add174c8c677f5590bd7174a79c9da99f111-1000x666.jpg?w=630&h=427&fit=crop 630w,\nhttps://cdn.sanity.io/images/hgftikht/production/a4d5add174c8c677f5590bd7174a79c9da99f111-1000x666.jpg?w=945&h=641&fit=crop 945w,\nhttps://cdn.sanity.io/images/hgftikht/production/a4d5add174c8c677f5590bd7174a79c9da99f111-1000x666.jpg?w=1000&h=678&fit=crop 1000w","srcWebp":"https://cdn.sanity.io/images/hgftikht/production/a4d5add174c8c677f5590bd7174a79c9da99f111-1000x666.jpg?w=630&h=427&fit=crop&fm=webp","srcSetWebp":"https://cdn.sanity.io/images/hgftikht/production/a4d5add174c8c677f5590bd7174a79c9da99f111-1000x666.jpg?w=158&h=107&fit=crop&fm=webp 158w,\nhttps://cdn.sanity.io/images/hgftikht/production/a4d5add174c8c677f5590bd7174a79c9da99f111-1000x666.jpg?w=315&h=214&fit=crop&fm=webp 315w,\nhttps://cdn.sanity.io/images/hgftikht/production/a4d5add174c8c677f5590bd7174a79c9da99f111-1000x666.jpg?w=630&h=427&fit=crop&fm=webp 630w,\nhttps://cdn.sanity.io/images/hgftikht/production/a4d5add174c8c677f5590bd7174a79c9da99f111-1000x666.jpg?w=945&h=641&fit=crop&fm=webp 945w,\nhttps://cdn.sanity.io/images/hgftikht/production/a4d5add174c8c677f5590bd7174a79c9da99f111-1000x666.jpg?w=1000&h=678&fit=crop&fm=webp 1000w","sizes":"(max-width: 630px) 100vw, 630px"}}},"author":{"name":"Benjamin Wootton","image":{"alt":"Benjamin Wootton","asset":{"fluid":{"base64":"data:image/png;base64,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","aspectRatio":1,"src":"https://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?w=80&h=80&fit=crop","srcSet":"https://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?w=120&h=120&fit=crop 120w,\nhttps://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?w=160&h=160&fit=crop 160w,\nhttps://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?w=240&h=240&fit=crop 240w,\nhttps://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png 420w","srcWebp":"https://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?w=80&h=80&fit=crop&fm=webp","srcSetWebp":"https://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?w=120&h=120&fit=crop&fm=webp 120w,\nhttps://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?w=160&h=160&fit=crop&fm=webp 160w,\nhttps://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?w=240&h=240&fit=crop&fm=webp 240w,\nhttps://cdn.sanity.io/images/hgftikht/production/3f296f1054c4071eddb46d9d64631cd858167912-420x420.png?fm=webp 420w","sizes":"(max-width: 80px) 100vw, 80px"}}}}}],"sanityPage":{"slug":{"current":"insights"},"blocks":[{"__typename":"SanitySignupBlock","_key":"bcb83330a70e","_type":"signupBlock","component":"module---src-components-blocks-signup-block-index-js-default-","reference":{"title":"Sign-up: Insights Directly to Your Inbox","subtitle":"Join tens of thousands of your peers and sign-up for our best content and industry commentary, curated by our experts.","successMessage":"Thanks for signing-up!","submitBtn":"Subscribe","marketoSnippet":"<script src=\"https://www10.contino.io/js/forms2/js/forms2.min.js\"></script><form id=\"mktoForm_1126\"></form>   <script>    MktoForms2.setOptions({formXDPath : \"/rs/964-BIK-421/images/marketo-xdframe-relative.html\"});    MktoForms2.loadForm(\"//www10.contino.io\", \"964-BIK-421\", 1126);   </script>"}}]}},"pageContext":{"sanityId":"32c86f3e-7b9d-431e-8a13-b0604d0e16f3"}},"staticQueryHashes":["2919194494","3157258374","3449559901"],"moduleDependencies":["module---src-components-blocks-signup-block-index-js-default-"]}