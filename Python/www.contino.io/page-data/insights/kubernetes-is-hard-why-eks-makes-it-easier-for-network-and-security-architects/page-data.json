{"componentChunkName":"component---src-templates-article-js","path":"/insights/kubernetes-is-hard-why-eks-makes-it-easier-for-network-and-security-architects","result":{"data":{"sanityArticle":{"publishedAt":"3 April 2018","publishedAtRaw":"2018-04-03","title":"Kubernetes Is Hard: Why EKS Makes It Easier for Network and Security Architects","seoTitle":"Kubernetes Is Hard: Why EKS Makes It Easier for Network and Security Architects","seoDescription":"The Kubernetes network stack is a significant point of contention...so AWS has lowered the barrier to entry by designing their own! The results are interesting.","slug":{"current":"kubernetes-is-hard-why-eks-makes-it-easier-for-network-and-security-architects"},"heroImage":{"alt":"Kubernetes Is Hard: Why EKS Makes It Easier for Network and Security Architects","asset":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAMABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQCBQYH/8QAIhAAAgICAQMFAAAAAAAAAAAAAQIAAwQRIQUTMRQjUnFy/8QAFwEAAwEAAAAAAAAAAAAAAAAAAgMEBf/EABsRAAICAwEAAAAAAAAAAAAAAAABAiIDERIh/9oADAMBAAIRAxEAPwDktHScF19vIrDnwGkrOjZKjdYSwD4MDM4lrh9A+BGRlXBtCxgAN8GaspJrwDBynYs/QZa8HHcn8wiQzclue/YPpoRO2XUP/9k=","aspectRatio":1.6666666666666667,"src":"https://cdn.sanity.io/images/hgftikht/production/b4014c6a194ee00f820466768be3a7e2821650c3-1000x600.jpg","srcSet":"https://cdn.sanity.io/images/hgftikht/production/b4014c6a194ee00f820466768be3a7e2821650c3-1000x600.jpg?w=250&h=150&fit=crop 250w,\nhttps://cdn.sanity.io/images/hgftikht/production/b4014c6a194ee00f820466768be3a7e2821650c3-1000x600.jpg?w=500&h=300&fit=crop 500w,\nhttps://cdn.sanity.io/images/hgftikht/production/b4014c6a194ee00f820466768be3a7e2821650c3-1000x600.jpg 1000w","srcWebp":"https://cdn.sanity.io/images/hgftikht/production/b4014c6a194ee00f820466768be3a7e2821650c3-1000x600.jpg?fm=webp","srcSetWebp":"https://cdn.sanity.io/images/hgftikht/production/b4014c6a194ee00f820466768be3a7e2821650c3-1000x600.jpg?w=250&h=150&fit=crop&fm=webp 250w,\nhttps://cdn.sanity.io/images/hgftikht/production/b4014c6a194ee00f820466768be3a7e2821650c3-1000x600.jpg?w=500&h=300&fit=crop&fm=webp 500w,\nhttps://cdn.sanity.io/images/hgftikht/production/b4014c6a194ee00f820466768be3a7e2821650c3-1000x600.jpg?fm=webp 1000w","sizes":"(max-width: 1000px) 100vw, 1000px"}}},"_rawBody":[{"_key":"0de718efcc3c","_type":"block","children":[{"_key":"d1dd97746963","_type":"span","marks":[],"text":"Running a "},{"_key":"489f1ecacbf9","_type":"span","marks":["79411cea55c2"],"text":"Kubernetes"},{"_key":"3a112057d953","_type":"span","marks":[],"text":" cluster today is hard. You first need to decide which cloud (or datacentre) you are going to deploy it to, then meticulously select appropriate network, storage, user and logging integrations."}],"markDefs":[{"_key":"79411cea55c2","_type":"link","href":"http://www.contino.io/insights/3-things-every-cto-should-know-about-kubernetes"}],"style":"normal"},{"_key":"ae584927a840","_type":"block","children":[{"_key":"041f7612b9d40","_type":"span","marks":[],"text":"If your requirements lie somewhere outside the norm, good luck finding a tool to wrap that up for you!"}],"markDefs":[],"style":"normal"},{"_key":"623e99832c94","_type":"block","children":[{"_key":"008d67a2aa3b0","_type":"span","marks":[],"text":"If you’re running in Google Cloud, you already have a battle hardened, production ready Kubernetes service available to you in GKE, but according to the "},{"_key":"9fcb4c762981","_type":"span","marks":["464dfd715ee7"],"text":"Cloud Native"},{"_key":"040c1a448627","_type":"span","marks":[],"text":" Computing Foundation, "},{"_key":"008d67a2aa3b1","_type":"span","marks":["2b20c257c1ba"],"text":"63% of Kubernetes workloads currently sit in AWS"},{"_key":"008d67a2aa3b2","_type":"span","marks":[],"text":". In response, AWS have announced its plans to provide Kubernetes as a Managed Service with EKS. If you want to find out more about the EKS and Fargate announcement, check out Carlos’s blog post "},{"_key":"008d67a2aa3b3","_type":"span","marks":["3bd0ef4f9b64"],"text":"here."},{"_key":"d65d8cbdb676","_type":"span","marks":[],"text":"​ "}],"markDefs":[{"_key":"2b20c257c1ba","_type":"link","href":"https://www.cncf.io/announcement/2017/08/09/amazon-web-services-joins-cloud-native-computing-foundation-platinum-member/"},{"_key":"3bd0ef4f9b64","_type":"link","href":"https://www.contino.io/insights/what-do-amazon-ecs-kubernetes-service-and-fargate-mean-for-you"},{"_key":"464dfd715ee7","_type":"link","blank":true,"href":"https://www.contino.io/insights/what-is-cloud-native-architecture-and-why-is-it-so-important"}],"style":"normal"},{"_key":"2c04548b367e","_type":"block","children":[{"_key":"14c0567714e70","_type":"span","marks":[],"text":"Today, we’ll have a look at why the Kubernetes network stack is overly complex, how AWS’s VPC container networking interface (CNI) simplifies the stack, and how it enables microsegmentation across security groups."}],"markDefs":[],"style":"normal"},{"_key":"64d1bc7ca6ac","_type":"block","children":[{"_key":"a45aafa1ab2c0","_type":"span","marks":[],"text":"By the way...if you find this post interesting and would like to hear more, you can catch Rory at AWS Summit in Sydney on Wednesday 10 April at 10:45am giving a 15 minute talk on Secure Kubernetes in AWS!"}],"markDefs":[],"style":"normal"},{"_key":"0d3ccdc7f3f5","_type":"block","children":[{"_key":"12ead36ef3e60","_type":"span","marks":[],"text":"Beware: The Kubernetes Network Stack!"}],"markDefs":[],"style":"h2"},{"_key":"3e239243cc49","_type":"block","children":[{"_key":"904a14c314180","_type":"span","marks":[],"text":"The most contentious point for building a Kubernetes cluster is the network stack. There are a tonne of providers available and if you have never deployed K8s before, it can be pretty daunting!"}],"markDefs":[],"style":"normal"},{"_key":"4c390ea5bf8d","_type":"block","children":[{"_key":"9bd5ab05ba8f0","_type":"span","marks":[],"text":"Kubernetes handles networking using a different approach to the normal ‘Docker way’ of doing things. "},{"_key":"9bd5ab05ba8f1","_type":"span","marks":["da99191e0cf9"],"text":"Docker"},{"_key":"9bd5ab05ba8f2","_type":"span","marks":[],"text":" uses port-forwarding from the host to the underlying container using virtual bridge network. This means that coordinating ports across multiple devices is a difficult thing to do at scale and exposes users to cluster-level issues outside of their control."}],"markDefs":[{"_key":"da99191e0cf9","_type":"link","href":"http://www.contino.io/insights/whos-using-docker"}],"style":"normal"},{"_key":"b3b99bcd1331","_type":"block","children":[{"_key":"7138ea1f2ab50","_type":"span","marks":[],"text":"Kubernetes on the other hand imposes the following requirements on its network implementation:"}],"markDefs":[],"style":"normal"},{"_key":"7184b5ece9e9","_type":"block","children":[{"_key":"3f62386b79b50","_type":"span","marks":[],"text":"All Pods should get their own IP Address, and the container should be able to see itself as the same IP that others see it"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"0b5bc3134c06","_type":"block","children":[{"_key":"8f93d22addb0","_type":"span","marks":[],"text":"All containers can communicate with each other without NAT"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"c3f489323584","_type":"block","children":[{"_key":"de8fc79a413a","_type":"span","marks":[],"text":"All nodes can communicate with all containers (and vice-versa) without NAT"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"b82cf04d278e","_type":"block","children":[{"_key":"2b0f639b63190","_type":"span","marks":[],"text":"Kubernetes provide a plugin specification called the "},{"_key":"2b0f639b63191","_type":"span","marks":["6149a63a32e6"],"text":"Container Networking Interface (CNI)"},{"_key":"2b0f639b63192","_type":"span","marks":[],"text":" to integrate the platform with the underlying network infrastructure. As long as the above requirements are met, vendors are free to implement the network stack as desired, and typically use overlay networks in order to support "},{"_key":"2b0f639b63193","_type":"span","marks":["strong"],"text":"multi-subnet"},{"_key":"2b0f639b63194","_type":"span","marks":[],"text":", "},{"_key":"2b0f639b63195","_type":"span","marks":["strong"],"text":"multi-az"},{"_key":"2b0f639b63196","_type":"span","marks":[],"text":" clusters."}],"markDefs":[{"_key":"6149a63a32e6","_type":"link","href":"https://kubernetes.io/docs/concepts/cluster-administration/networking/"}],"style":"normal"},{"_key":"3d7b85c72dca","_type":"block","children":[{"_key":"66446a67a20f0","_type":"span","marks":["strong"],"text":"What Is an Overlay Network?"}],"markDefs":[],"style":"h2"},{"_key":"decd3ac44b53","_type":"block","children":[{"_key":"ea835acd7c830","_type":"span","marks":[],"text":"An overlay network is a type of networking whereby administrators create multiple atomic and discrete virtualized network layers on top of the physical infrastructure. It decouples network services from the underlying infrastructure by leveraging encapsulation techniques, such as NVGRE or VXLan to wrap one packet inside another packet."}],"markDefs":[],"style":"normal"},{"_key":"c1f038a73e20","_type":"block","children":[{"_key":"095868f5ed990","_type":"span","marks":[],"text":"A common example of an overlay network is the AWS Virtual Private Cloud, which allows Amazon to run thousands of private, atomic networks across across millions of devices, spanning multiple sites and regions."}],"markDefs":[],"style":"normal"},{"_key":"aeb44491b7c3","_type":"block","children":[{"_key":"eff957a963dd0","_type":"span","marks":[],"text":"In the context of Kubernetes, an overlay network allows Pods in a Kubernetes cluster to communicate over multiple clusters in a separate IP range to the underlying VPC."}],"markDefs":[],"style":"normal"},{"_key":"f29e6ded8617","_type":"block","children":[{"_key":"b4d836712a900","_type":"span","marks":[],"text":"In the following example, we can see how overlay networks are implemented through the use of a popular CNI called "},{"_key":"b4d836712a901","_type":"span","marks":["992f4342da54"],"text":"Flannel"},{"_key":"b4d836712a902","_type":"span","marks":[],"text":". Assume the Pod "},{"_key":"b4d836712a903","_type":"span","marks":["strong"],"text":"Web App Frontend 1"},{"_key":"b4d836712a904","_type":"span","marks":[],"text":" which is located in "},{"_key":"b4d836712a905","_type":"span","marks":["strong"],"text":"Node1"},{"_key":"b4d836712a906","_type":"span","marks":[],"text":" wants to talk to the pod "},{"_key":"b4d836712a907","_type":"span","marks":["strong"],"text":"Backend Service 2"},{"_key":"b4d836712a908","_type":"span","marks":[],"text":" which is located in "},{"_key":"b4d836712a909","_type":"span","marks":["strong"],"text":"Node2."}],"markDefs":[{"_key":"992f4342da54","_type":"link","href":"https://github.com/coreos/flannel"}],"style":"normal"},{"_key":"0161bfc71f0b","_type":"block","children":[{"_key":"c6ff1c3afd3e","_type":"span","marks":["strong"],"text":""}],"markDefs":[],"style":"normal"},{"_key":"dc4fea757ee2","_type":"imageArticle","asset":{"_id":"image-1b228c7fea815cdc70a75dc1bc01d72bce3e503d-1600x972-png","_type":"sanity.imageAsset","_rev":"qD2nwhohCpR7vPHyE9dCX6","_createdAt":"2020-09-17T17:48:12Z","_updatedAt":"2020-09-17T17:48:12Z","assetId":"1b228c7fea815cdc70a75dc1bc01d72bce3e503d","extension":"png","metadata":{"_type":"sanity.imageMetadata","dimensions":{"_type":"sanity.imageDimensions","aspectRatio":1.646090534979424,"height":972,"width":1600},"hasAlpha":false,"isOpaque":true,"lqip":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAAByElEQVQoz11S227bMAzt///LBuzy0pcNaIFd3gYMWDsnWTCkaBZfJOtKSpSUHbvJw0YThkTynEOTvmmtVZHkw6zMNKipH6dhVKMOxhZOJWeyXk8awek0jANOMzlfUm613lRYzqN2X/bTx+3w7aA+78cPXd89ayKWlJ8Hc78d7nbj9yd1vxvvtsOhN5lTvYBT/qP87Ua9fhw/HcztTr/6ARYdV/C+t28fx3ed+vpk33fqzcOwOc5MqZYV3HL2LvwazMNJ/57MFoejPo5zIkZ7s/Gbk+l6c1C26/XPoxonk4lKKRdwRYsUXXAzHjB5T9blGAtziZEj+eAtUsHG4NlZpETkAm7MVTIzIDbGICnlEMg59r5ARIQIN0sUkZIQcF/A7aq8zDwlD01U5ywQdA4IKCPFDB6PN1JLJK0DO2NXIo2oQY05oCtac6CAoyPwgpUJ38JrEMolpWVVZ1it55zO6IcZPSeKLTGurRT4cmBGMHgXnY/z7LVG3RUMa/W8LK1IyVLQkgBWV2/YiWRK1pH23hqtZ63oH/DVGmhagUsRyHFiQKUmn5XhwUPa+2WiIij+H/yCbwsYapEySc2lSS74YwJxXGZW5KXyLx9Wr+SpeHNPAAAAAElFTkSuQmCC","palette":{"_type":"sanity.imagePalette","darkMuted":{"_type":"sanity.imagePaletteSwatch","background":"#075c91","foreground":"#fff","population":0,"title":"#fff"},"darkVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#06507e","foreground":"#fff","population":0,"title":"#fff"},"dominant":{"_type":"sanity.imagePaletteSwatch","background":"#78d7fa","foreground":"#000","population":0.07,"title":"#fff"},"lightMuted":{"_type":"sanity.imagePaletteSwatch","background":"#bcc4dc","foreground":"#000","population":0.01,"title":"#fff"},"lightVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#78d7fa","foreground":"#000","population":0.07,"title":"#fff"},"muted":{"_type":"sanity.imagePaletteSwatch","background":"#559aaa","foreground":"#fff","population":0.02,"title":"#fff"},"vibrant":{"_type":"sanity.imagePaletteSwatch","background":"#38adf5","foreground":"#fff","population":0.03,"title":"#fff"}}},"mimeType":"image/png","originalFilename":"pasted_image_0[1].png","path":"images/hgftikht/production/1b228c7fea815cdc70a75dc1bc01d72bce3e503d-1600x972.png","sha1hash":"1b228c7fea815cdc70a75dc1bc01d72bce3e503d","size":172644,"uploadId":"VZnnIbRZ7pBlJHmFCpUtJScZhkTewQCH","url":"https://cdn.sanity.io/images/hgftikht/production/1b228c7fea815cdc70a75dc1bc01d72bce3e503d-1600x972.png","id":"image-1b228c7fea815cdc70a75dc1bc01d72bce3e503d-1600x972-png","parent":null,"children":["ed51d582-6276-5d12-bf76-6b81b610ad5f"],"internal":{"type":"SanityImageAsset","contentDigest":"e91e21d8ed519393b7c4b2e1c134afa1","counter":2731,"owner":"gatsby-source-sanity"}}},{"_key":"ddf86854d8a6","_type":"block","children":[{"_key":"652749035488","_type":"span","marks":["strong"],"text":"Web App Frontend 1"},{"_key":"59f4e895fea2","_type":"span","marks":[],"text":" creates an IP packet with "},{"_key":"e4368e9ddf86","_type":"span","marks":["strong"],"text":"source: 10.1.15.2 -> destination: 10.1.20.3"},{"_key":"a8f552114115","_type":"span","marks":[],"text":". This packet will leave the virtual adapter (veth0) which is attached to that pod and go to the "},{"_key":"06ca9a0763b3","_type":"span","marks":["strong"],"text":"docker0"},{"_key":"7582c60b932d","_type":"span","marks":[],"text":" bridge. Docker0 will then consult it’s route table, where it sees that all endpoints outside of "},{"_key":"71e1c3ab75a1","_type":"span","marks":["strong"],"text":"10.1.15.0/24"},{"_key":"3cb323ee7f2b","_type":"span","marks":[],"text":" sit on "},{"_key":"71b41b67048f","_type":"span","marks":["em"],"text":"other"},{"_key":"0f2f011bd627","_type":"span","marks":[],"text":" hosts, and forwards it to the "},{"_key":"a621d43251ff","_type":"span","marks":["strong"],"text":"flannel0"},{"_key":"7be0213d50f7","_type":"span","marks":[],"text":" endpoint accordingly."}],"markDefs":[],"style":"normal"},{"_key":"b65f7a9d0fc9","_type":"block","children":[{"_key":"4cc8c4e902490","_type":"span","marks":[],"text":"The "},{"_key":"4cc8c4e902491","_type":"span","marks":["strong"],"text":"flannel0"},{"_key":"4cc8c4e902492","_type":"span","marks":[],"text":" bridge works with the flanneld process to manage a mapping of hosts to network zones in the Kubernetes KV Store, ETCD. In this case, it knows that "},{"_key":"4cc8c4e902493","_type":"span","marks":["strong"],"text":"10.1.20.3 sits"},{"_key":"4cc8c4e902494","_type":"span","marks":[],"text":" in on the host "},{"_key":"4cc8c4e902495","_type":"span","marks":["strong"],"text":"192.168.0.200"},{"_key":"4cc8c4e902496","_type":"span","marks":[],"text":" and will wrap the packet in "},{"_key":"4cc8c4e902497","_type":"span","marks":["em"],"text":"another"},{"_key":"4cc8c4e902498","_type":"span","marks":[],"text":" packet with "},{"_key":"4cc8c4e902499","_type":"span","marks":["strong"],"text":"source: 192.168.0.100 -> destination 192.168.0.200."}],"markDefs":[],"style":"normal"},{"_key":"52ec7c3f5d39","_type":"block","children":[{"_key":"78cfbd2ba9f60","_type":"span","marks":[],"text":"The packet will then travel out through the VPC network to the destination host and hit the destinations flanneld. From there, it reverses the process above and travels to the destination pod."}],"markDefs":[],"style":"normal"},{"_key":"31e4fcf1d581","_type":"block","children":[{"_key":"db5f55fea92d0","_type":"span","marks":[],"text":"And now remember that the VPC is also an overlay encapsulating the packet. That’s three network layers!"}],"markDefs":[],"style":"normal"},{"_key":"e583febbc9ab","_type":"block","children":[{"_key":"ef567f51f6a20","_type":"span","marks":["strong"],"text":"It’s complex as hell!"}],"markDefs":[],"style":"normal"},{"_key":"e4ad78f0a62b","_type":"block","children":[{"_key":"05797518dbc20","_type":"span","marks":[],"text":"Not only that, running an overlay network in AWS doesn’t work."}],"markDefs":[],"style":"h4"},{"_key":"5f4b82c55dd9","_type":"block","children":[{"_key":"c3c69fbd17080","_type":"span","marks":[],"text":"Why not?"}],"markDefs":[],"style":"normal"},{"_key":"b9e0c6a3c380","_type":"block","children":[{"_key":"4af1a94025c60","_type":"span","marks":["strong"],"text":"VPC Flow Logs don’t work:"},{"_key":"4af1a94025c61","_type":"span","marks":[],"text":" The underlying VPC has no context for the encapsulated overlay network that is running on top of it. VPC flow logs will only show traffic between the hosts in the Kubernetes cluster and makes troubleshooting any network related issues a pain."}],"markDefs":[],"style":"normal"},{"_key":"5a89b65d6950","_type":"block","children":[{"_key":"6ea8aef60e4c0","_type":"span","marks":["strong"],"text":"Security Groups don’t work:"},{"_key":"6ea8aef60e4c1","_type":"span","marks":[],"text":" Since the VPC has no context for the overlay network, it is unable to apply security policies to the individual pods, instead only applying them to the Kubernetes cluster itself. This means you need to run, manage and maintain two sets of network policy controls."}],"markDefs":[],"style":"normal"},{"_key":"e4509d719be3","_type":"block","children":[{"_key":"bc4a40d5ef9f0","_type":"span","marks":["strong"],"text":"I have another thing I can break:"},{"_key":"bc4a40d5ef9f1","_type":"span","marks":[],"text":" By implementing an overlay network, I have created another fault domain for my application stack. The more fault domains that I need to worry about, the more likely I am going to be woken up at 3am with a problem that affects every single application in the cluster."}],"markDefs":[],"style":"normal"},{"_key":"f0eef646d3fe","_type":"block","children":[{"_key":"19432048b8d10","_type":"span","marks":["strong"],"text":"I don’t want to manage this stuff anymore:"},{"_key":"19432048b8d11","_type":"span","marks":[],"text":" The reason we are moving to the cloud is to shift the accountability away from me and to a company that can scale these services larger, better, faster and more efficiently than I could dream to. By creating another network stack for me to manage, I feel like I’m stepping back into the dark ages of on-premise networks."}],"markDefs":[],"style":"normal"},{"_key":"d1b076cfc254","_type":"block","children":[{"_key":"e2a79dee70e80","_type":"span","marks":["strong"],"text":"But don’t worry! AWS to the rescue!"}],"markDefs":[],"style":"normal"},{"_key":"ff843eff765a","_type":"block","children":[{"_key":"ccb789e0dfee0","_type":"span","marks":[],"text":"Rather than leverage one of the existing providers, AWS are building their own…"},{"_key":"ccb789e0dfee1","_type":"span","marks":["em"],"text":"and the results are pretty cool."}],"markDefs":[],"style":"normal"},{"_key":"6887c42e8049","_type":"block","children":[{"_key":"20654d556b490","_type":"span","marks":[],"text":"The AWS VPC CNI"}],"markDefs":[],"style":"h3"},{"_key":"3ed3fa332605","_type":"block","children":[{"_key":"ed2d0ef2c0f80","_type":"span","marks":[],"text":"AWS agrees that overlay networking is not the most ideal way to manage the networks for AWS EKS and has instead built their own CNI interface and "},{"_key":"ed2d0ef2c0f81","_type":"span","marks":["ff928ae4a64e"],"text":"has open sourced it to boot."},{"_key":"ed2d0ef2c0f82","_type":"span","marks":[],"text":" While still "},{"_key":"ed2d0ef2c0f83","_type":"span","marks":["strong"],"text":"very much in Alpha"},{"_key":"ed2d0ef2c0f84","_type":"span","marks":[],"text":", we can see that the implementation is trying to solve some of the very frustrations we see with overlay networks."}],"markDefs":[{"_key":"ff928ae4a64e","_type":"link","href":"https://github.com/aws/amazon-vpc-cni-k8s"}],"style":"normal"},{"_key":"d8e3c2eb3265","_type":"block","children":[{"_key":"a037793361e50","_type":"span","marks":[],"text":"It looks to achieve the following goals:"}],"markDefs":[],"style":"normal"},{"_key":"281c12e78603","_type":"block","children":[{"_key":"85d42fb0e6380","_type":"span","marks":[],"text":"Pod network connectivity performance must be similar to AWS VPC Network. That is, low latency, minimal jitter, high throughput and high availability"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"efad2bc51ca4","_type":"block","children":[{"_key":"ab44afbbcca5","_type":"span","marks":[],"text":"Users must be able to express and enforce granular network policies and isolation comparable to those achievable with native EC2 networking and security groups"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"8d09433028f6","_type":"block","children":[{"_key":"e1065230a2b4","_type":"span","marks":[],"text":"Network operation must be simple and secure. Users must be able to apply existing AWS VPC networking and security best practices for building Kubernetes clusters over AWS VPC"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"9b70ecb3d553","_type":"block","children":[{"_key":"9e7cab5cdc22","_type":"span","marks":[],"text":"VPC Flow Logs must work"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"70163cc89a10","_type":"block","children":[{"_key":"1606720e8604","_type":"span","marks":[],"text":"VPC Routing Policies must work"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"ee621a5ecbe7","_type":"block","children":[{"_key":"7243ab60c9f2","_type":"span","marks":[],"text":"Pod Network Setup in Seconds"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"7fbba160c623","_type":"block","children":[{"_key":"7330959b614c","_type":"span","marks":[],"text":"Pods must be able to attach to the network in seconds"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"7b7b648577a1","_type":"block","children":[{"_key":"92e50e7f1e34","_type":"span","marks":[],"text":"Clusters should be able to scale to ~2000 nodes.\n"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"807f6929e27e","_type":"block","children":[{"_key":"a8f557a89c6e0","_type":"span","marks":[],"text":"To achieve this outcome, AWS "},{"_key":"a8f557a89c6e1","_type":"span","marks":["em"],"text":"abuses"},{"_key":"a8f557a89c6e2","_type":"span","marks":[],"text":" its ability to attach multiple Elastic Network Interfaces (ENIs or vNICs) to a virtual machine, and associate multiple secondary IP addresses with each ENI. Each pod is then able to pick a free secondary IP address, assign it to the pod and allow it to communicate inbound/outbound over that interface."}],"markDefs":[],"style":"normal"},{"_key":"40a14799ded1","_type":"block","children":[{"_key":"04f9e5b02088","_type":"span","marks":[],"text":""}],"markDefs":[],"style":"normal"},{"_key":"b18592e0aae0","_type":"imageArticle","asset":{"_id":"image-dc1f912510f1817d7c6b14d1ea53a337e1a35996-1600x989-png","_type":"sanity.imageAsset","_rev":"EKvk0y0sZhG3MJulrpQeCe","_createdAt":"2020-09-17T17:50:02Z","_updatedAt":"2020-09-17T17:50:02Z","assetId":"dc1f912510f1817d7c6b14d1ea53a337e1a35996","extension":"png","metadata":{"_type":"sanity.imageMetadata","dimensions":{"_type":"sanity.imageDimensions","aspectRatio":1.6177957532861476,"height":989,"width":1600},"hasAlpha":false,"isOpaque":true,"lqip":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAAB20lEQVQoz22QyW7UQBCG/f5PABfECYkTkQKXSNxGYlHQkIA0TEhgJokzHtu9VvW+mLIjJIRSXYfu6v/r+qubqPShY19+Hih/t8PVbf9x217edHIUNYQpBBRqu+8/bR82u37/MK5vOtrv29FL3VgN6zvxYn18+bVf7eTZNX923r2+7PdHVUKsMR4ZnG4GKp7+YB9u1atvw/PzbvWLKQWNB9x26u12fHfFLzr4fK9PNuz9NesYlDjDTOJqJ95sxtVefj/i2Y042QwX98JoaDKi1tCOvGVcADKN94M4Muk01AUOaAahqThIkGAOXN4NIxc8ad1UxGiNNWCcDtGR2Dnrrc3WTjFSFjsfjTHe+/nWk1o5FFnLBUa6QuPxEQ7B0wME17+wM0TbFEJOiQTeG29k0ryp1gZA0ArIFAgLmhKUsgAknVIq1lnA+UgvOotaKcGt4gmpMz1GnWZjoLVEUAakVNwg5pynWktK5NU545w2RjA29H0Hmudgm2kiQS2lkDTGOPtK3gUTks8llyUpXELm2hFbLpkQgsak+gz/F3WqmfyUEJKjcX20tHcZuD9I39PvLT8XqeUT8MIX4n106LT1SHCi3yueNuSxLkGyp+HH/mQs0SqJxpqHW/JfzR9sx6korrN5jwAAAABJRU5ErkJggg==","palette":{"_type":"sanity.imagePalette","darkMuted":{"_type":"sanity.imagePaletteSwatch","background":"#717070","foreground":"#fff","population":0.25,"title":"#fff"},"darkVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#115472","foreground":"#fff","population":0,"title":"#fff"},"dominant":{"_type":"sanity.imagePaletteSwatch","background":"#717070","foreground":"#fff","population":0.25,"title":"#fff"},"lightMuted":{"_type":"sanity.imagePaletteSwatch","background":"#98c0cf","foreground":"#000","population":0.02,"title":"#fff"},"lightVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#77dafa","foreground":"#000","population":0.01,"title":"#fff"},"muted":{"_type":"sanity.imagePaletteSwatch","background":"#6498ab","foreground":"#fff","population":0.04,"title":"#fff"},"vibrant":{"_type":"sanity.imagePaletteSwatch","background":"#22a2dd","foreground":"#fff","population":0.04,"title":"#fff"}}},"mimeType":"image/png","originalFilename":"pasted image 0 (2).png","path":"images/hgftikht/production/dc1f912510f1817d7c6b14d1ea53a337e1a35996-1600x989.png","sha1hash":"dc1f912510f1817d7c6b14d1ea53a337e1a35996","size":167744,"uploadId":"wBWcUVXvdvRrrsk5ilsN7o9Ajc5wR2i3","url":"https://cdn.sanity.io/images/hgftikht/production/dc1f912510f1817d7c6b14d1ea53a337e1a35996-1600x989.png","id":"image-dc1f912510f1817d7c6b14d1ea53a337e1a35996-1600x989-png","parent":null,"children":["5d4e9428-caa3-5a84-a3ce-f005eb38b8e6"],"internal":{"type":"SanityImageAsset","contentDigest":"7be7102378f0def514ad7d542994f9bc","counter":2740,"owner":"gatsby-source-sanity"}}},{"_key":"000734655da7","_type":"block","children":[{"_key":"40e5e374424f","_type":"span","marks":[],"text":"If we use the same diagram as before, we can see that to route from A->B, we no longer need to worry about Kubernetes encapsulating the packet as all communications can take place using IP addresses in the VPC."}],"markDefs":[],"style":"normal"},{"_key":"fbc263bec565","_type":"block","children":[{"_key":"a64982961d0d0","_type":"span","marks":[],"text":"Network architects can breathe a sigh of relief: "},{"_key":"a64982961d0d1","_type":"span","marks":["em"],"text":"this significantly simplifies the stack!"}],"markDefs":[],"style":"normal"},{"_key":"cce32a2cc7ab","_type":"block","children":[{"_key":"aa8e32637dd10","_type":"span","marks":[],"text":"Security Architects and Microsegmentation"}],"markDefs":[],"style":"h3"},{"_key":"eb3b933a98fe","_type":"block","children":[{"_key":"d8b3b17eeff30","_type":"span","marks":[],"text":"Now onto what this means for our security architects!"}],"markDefs":[],"style":"normal"},{"_key":"329ffd2f21f1","_type":"block","children":[{"_key":"04f554ae5de40","_type":"span","marks":[],"text":"The AWS VPC CNI means that we might soon see "},{"_key":"04f554ae5de41","_type":"span","marks":["em"],"text":"native microsegmentation"},{"_key":"04f554ae5de42","_type":"span","marks":[],"text":" using AWS Security Groups!"}],"markDefs":[],"style":"normal"},{"_key":"0ebedb3e1bab","_type":"block","children":[{"_key":"e881d9e0b6060","_type":"span","marks":[],"text":"Microsegmentation is the ability to apply network security policies to virtual machines, and is a key control used to reduce the likelihood of east/west intrusions in the data centre by applying application contextual network policies, rather than simply having firewalls on the edge of the DMZ, Application and Database zones like the network designs of old. "},{"_key":"e881d9e0b6061","_type":"span","marks":["01016d10548a"],"text":"SDXCentral have a good article explaining microsegmentation further."},{"_key":"4cc28f6c8871","_type":"span","marks":[],"text":"​ "}],"markDefs":[{"_key":"01016d10548a","_type":"link","href":"https://www.sdxcentral.com/sdn/network-virtualization/definitions/how-does-micro-segmentation-help-security-explanation/"}],"style":"normal"},{"_key":"b0fbdd11e849","_type":"block","children":[{"_key":"cb7386754bcf0","_type":"span","marks":[],"text":"If you have been running in AWS, Google or NSX for a while, you would be pretty familiar with the concept of microsegmentation, even if you didn’t realise it!"}],"markDefs":[],"style":"normal"},{"_key":"aac70975cc0a","_type":"block","children":[{"_key":"ca644d44c85e0","_type":"span","marks":["strong"],"text":"Below is a fairly typical example of microsegmentation in AWS."}],"markDefs":[],"style":"normal"},{"_key":"94b511fc515a","_type":"block","children":[{"_key":"dfd83d5fa11b","_type":"span","marks":["strong"],"text":""}],"markDefs":[],"style":"normal"},{"_key":"5aea34632dce","_type":"imageArticle","asset":{"_id":"image-0efb3d06951fa129a10cf913d650887437083945-1378x894-png","_type":"sanity.imageAsset","_rev":"qD2nwhohCpR7vPHyE9dHvX","_createdAt":"2020-09-17T17:51:30Z","_updatedAt":"2020-09-17T17:51:30Z","assetId":"0efb3d06951fa129a10cf913d650887437083945","extension":"png","metadata":{"_type":"sanity.imageMetadata","dimensions":{"_type":"sanity.imageDimensions","aspectRatio":1.541387024608501,"height":894,"width":1378},"hasAlpha":false,"isOpaque":true,"lqip":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABn0lEQVQoz3VSXW8aMRC8//+Xor5Efaj6kkZNSQX5ABqag8PGPn+t7bXpGNIIlLDyrXT2zu7M2N0eUev+Q3Ap1lqlVIxxfyE6IGvJtTJ6vO9iLzNrrYUQRHQRDCQnx5nQo75HKZyzd9aOY4rx7OgkOswsmUobXs/AMUS5puFPdiP+LoFb7SnnI2/2Jix/udn3KHuwqOe+nII/GAbNIL161M93dttHArXyGbjJi/hKeSN8zIlolEJueiUEtGcM/19xOG+5Ayz5MVodncsxlowuCAbYaqWkMFoH71POII9rM9Y75+EiijAZZptxMZeTez8MJaXWGwZ66/u5XT0ELUEbMACE1D9+r+6f1sb4wgzNJXm/nUwWV1/kdMbtVmvT7Eb7dKPurv3wQiH44In8315cfZt+vV1IbcGuw5RMpFar19ufarHkEPbQkzNZs1vOxPTGbV9zpJwist6ph8eX+bJ31jUwdDcxzgWloxkLhZoS5ntjdsNGb9aETbyTlJDZORp1tJZjapqb7xjF3BbcwuKDN0TGWGfsm4vcjupxofLg9j8Jq/OIrmAiZwAAAABJRU5ErkJggg==","palette":{"_type":"sanity.imagePalette","darkMuted":{"_type":"sanity.imagePaletteSwatch","background":"#863d43","foreground":"#fff","population":0.04,"title":"#fff"},"darkVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#9c1c24","foreground":"#fff","population":0.01,"title":"#fff"},"dominant":{"_type":"sanity.imagePaletteSwatch","background":"#cca7a3","foreground":"#000","population":0.51,"title":"#fff"},"lightMuted":{"_type":"sanity.imagePaletteSwatch","background":"#cca7a3","foreground":"#000","population":0.51,"title":"#fff"},"lightVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#fcbc74","foreground":"#000","population":0,"title":"#fff"},"muted":{"_type":"sanity.imagePaletteSwatch","background":"#af6c56","foreground":"#fff","population":0.14,"title":"#fff"},"vibrant":{"_type":"sanity.imagePaletteSwatch","background":"#b47c2c","foreground":"#fff","population":0,"title":"#fff"}}},"mimeType":"image/png","originalFilename":"pastedImage0.png","path":"images/hgftikht/production/0efb3d06951fa129a10cf913d650887437083945-1378x894.png","sha1hash":"0efb3d06951fa129a10cf913d650887437083945","size":57444,"uploadId":"mc1EAlFRurNRMO2cSTnrYhoyJt5NHpTe","url":"https://cdn.sanity.io/images/hgftikht/production/0efb3d06951fa129a10cf913d650887437083945-1378x894.png","id":"image-0efb3d06951fa129a10cf913d650887437083945-1378x894-png","parent":null,"children":["f16f0cf5-dbab-5e01-87bf-fd8fd21e525d"],"internal":{"type":"SanityImageAsset","contentDigest":"b310df227d2ee8b7db2dbc5602af3a21","counter":2745,"owner":"gatsby-source-sanity"}}},{"_key":"f7582b1f8bd5","_type":"block","children":[{"_key":"400d8eaea1ae","_type":"span","marks":[],"text":"In this example, we can see an extremely simple investments application that is split into three layers: a load balancing tier fronted by AWS ALB, an app tier running on EC2 and a database tier RDS. Each of these layers has its own security group that explicitly allows traffic flows between each tier and implicitly denies all other traffic."}],"markDefs":[],"style":"normal"},{"_key":"d3d793b0b8c0","_type":"block","children":[{"_key":"303c20578b140","_type":"span","marks":[],"text":"In the situation that another workload has been compromised, we have a control in place that makes it impossible for workloads to escalate east/west to other services in the same subnet."}],"markDefs":[],"style":"normal"},{"_key":"ca281bfe0e03","_type":"block","children":[{"_key":"083303fdd7050","_type":"span","marks":["strong"],"text":"But what happens when you introduce Kubernetes into the mix?"}],"markDefs":[],"style":"normal"},{"_key":"f20ceabd61a7","_type":"block","children":[{"_key":"3a28b2e1dc53","_type":"span","marks":["strong"],"text":""}],"markDefs":[],"style":"normal"},{"_key":"8e49b3d35b4d","_type":"imageArticle","asset":{"_id":"image-b00e62e50158d7db62620d9d5ea0a7dc28ee2e77-1600x1066-png","_type":"sanity.imageAsset","_rev":"EKvk0y0sZhG3MJulrpRDLv","_createdAt":"2020-09-17T17:53:45Z","_updatedAt":"2020-09-17T17:53:45Z","assetId":"b00e62e50158d7db62620d9d5ea0a7dc28ee2e77","extension":"png","metadata":{"_type":"sanity.imageMetadata","dimensions":{"_type":"sanity.imageDimensions","aspectRatio":1.5009380863039399,"height":1066,"width":1600},"hasAlpha":false,"isOpaque":true,"lqip":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABiElEQVQoz3VS7W7bMAzM+z/T/q8BhqFrMXRLOqBx58SOo+jTIiVK8qh42ZKgOQiELfEo3omLaSpTyTVeoJRCROIouq4DgOkOFqWknDDnWK6RUnLOaqVCCOUjnMiZUvQp3WbkGIKRoA4EvuT8IZ9vzjlRqZ1f9Z28w+0K3p5JH0pONw3X6jkvTh/lRjPv0Wjd5rtZfwlyz4l3yOebuUI571KMwIL7Vu0atDqndKn1X1rVTOgijinGRKyfEGBkr4zRR2mU4l8mc2qN6T9mMvtlvBFCqkE6qX13MINQpt+rpnFCRESa0yk653/vZDdogDCT+aVqj+udfGzUurNfN2q1lWL1a3hY2qaJABgCIgaEbSc+LV8/P79LM57JIfAktNK/7t3mYF9atemVfm/1yw/f90wOJ8SAw/64fHr79rM19oJMWEuPHowxRyG10mgdao6Wj9JZM3ovhVJScyelktk3PiNiz9kwLh88RECuWHsFYCP/DgnH6hmdVvV/Mb/adDVc88qzt+UOmPcHHR7z9Hdj4xQAAAAASUVORK5CYII=","palette":{"_type":"sanity.imagePalette","darkMuted":{"_type":"sanity.imagePaletteSwatch","background":"#68383e","foreground":"#fff","population":0.04,"title":"#fff"},"darkVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#2a3c5a","foreground":"#fff","population":0.01,"title":"#fff"},"dominant":{"_type":"sanity.imagePaletteSwatch","background":"#68383e","foreground":"#fff","population":0.04,"title":"#fff"},"lightMuted":{"_type":"sanity.imagePaletteSwatch","background":"#afc4cc","foreground":"#000","population":0.01,"title":"#fff"},"lightVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#7cccfc","foreground":"#000","population":0,"title":"#fff"},"muted":{"_type":"sanity.imagePaletteSwatch","background":"#a48874","foreground":"#fff","population":0,"title":"#fff"},"vibrant":{"_type":"sanity.imagePaletteSwatch","background":"#ec8434","foreground":"#000","population":0,"title":"#fff"}}},"mimeType":"image/png","originalFilename":"pastedImage0 (1).png","path":"images/hgftikht/production/b00e62e50158d7db62620d9d5ea0a7dc28ee2e77-1600x1066.png","sha1hash":"b00e62e50158d7db62620d9d5ea0a7dc28ee2e77","size":109280,"uploadId":"QDvLhTzujXU4pylkarknvJzROdyzxn9h","url":"https://cdn.sanity.io/images/hgftikht/production/b00e62e50158d7db62620d9d5ea0a7dc28ee2e77-1600x1066.png","id":"image-b00e62e50158d7db62620d9d5ea0a7dc28ee2e77-1600x1066-png","parent":null,"children":["47725366-ebb2-556b-8d7b-43a6b9a0bd2c"],"internal":{"type":"SanityImageAsset","contentDigest":"41e4d04c63d2636e26aa71d48ef65b16","counter":2750,"owner":"gatsby-source-sanity"}}},{"_key":"67edba43cfed","_type":"block","children":[{"_key":"2f71fd29813b","_type":"span","marks":[],"text":"In the old world of Calico/Weave/Flannel, the VPC had no context for the pods, and could only apply security groups to the hosts running the containers. In effect, this meant that any Pod could route to any service that has been exposed to the cluster. If one of those pods gets compromised, it could potentially escalate to a database of which it has access."}],"markDefs":[],"style":"normal"},{"_key":"51fb5760f9d9","_type":"block","children":[{"_key":"83206776883f0","_type":"span","marks":["strong"],"text":"But I thought Kubernetes had nano segmentation?"}],"markDefs":[],"style":"normal"},{"_key":"7c56f7894912","_type":"block","children":[{"_key":"bc7c1bccfcf70","_type":"span","marks":[],"text":"Kind of…there are a number of tools available to tackle the problem of network segmentation within the cluster. They are typically implemented using a mix of os packages, container side cars or docker daemon sets, but these "},{"_key":"bc7c1bccfcf71","_type":"span","marks":["em"],"text":"add yet another layer of complexity to your deployment stack"},{"_key":"bc7c1bccfcf72","_type":"span","marks":[],"text":"!"}],"markDefs":[],"style":"normal"},{"_key":"8246bbe0b6c6","_type":"block","children":[{"_key":"fd46879cfba8","_type":"span","marks":[],"text":""}],"markDefs":[],"style":"normal"},{"_key":"005dd10ea4d1","_type":"imageArticle","asset":{"_id":"image-7a13d480140db6abbf70eb41c80fbd7db91bdea2-1600x755-png","_type":"sanity.imageAsset","_rev":"qD2nwhohCpR7vPHyE9dQAV","_createdAt":"2020-09-17T17:55:10Z","_updatedAt":"2020-09-17T17:55:10Z","assetId":"7a13d480140db6abbf70eb41c80fbd7db91bdea2","extension":"png","metadata":{"_type":"sanity.imageMetadata","dimensions":{"_type":"sanity.imageDimensions","aspectRatio":2.119205298013245,"height":755,"width":1600},"hasAlpha":false,"isOpaque":true,"lqip":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABWklEQVQoz21QSW4cMQzs/z8oRyMXHwL4EMBLgInHBmZJJpleRYniqgm7s5xSKBCExCounTIqgxubi1jdSGt0YsOqOSIb/WWNqK7uzd07U1EuSrnWjJSZqwoJISNILSrVTMzVmrlr/C4AuaCqbmJmwZTm4e3S7y8jJNBSyuX7+PIMx4OWHAUqEtUm3A/zw/Pxcf8jAZpqF27RYVjSw3v/af/z2k88T9PX3fnubnh65JQYsWINRHI6Xz/c7z5+PgxzDsdVrEwF6/G6vH/r+2uf+ut8Pg5fXuB8UsS14DeY53HZvZ7eDpeSy9rZ4kzMxiS1YoY0Tcs0lnmicdC0WK3OFMs2k6ZipdA4UrwLrzu7WbCZBsNMhGXzsgy2zAbJCkhZDKFhaSU7gBOF0lvr2nb1P2zNN0YeeoJEGbSiEhrXVRNTcExhbUN3u93a/2AW26xTrHP55rm5/0MIfwEywgaoiKuOpwAAAABJRU5ErkJggg==","palette":{"_type":"sanity.imagePalette","darkMuted":{"_type":"sanity.imagePaletteSwatch","background":"#2e425b","foreground":"#fff","population":0.08,"title":"#fff"},"darkVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#24447c","foreground":"#fff","population":0,"title":"#fff"},"dominant":{"_type":"sanity.imagePaletteSwatch","background":"#a3c0d4","foreground":"#000","population":0.34,"title":"#fff"},"lightMuted":{"_type":"sanity.imagePaletteSwatch","background":"#a3c0d4","foreground":"#000","population":0.34,"title":"#fff"},"lightVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#7cc4fc","foreground":"#000","population":0.01,"title":"#fff"},"muted":{"_type":"sanity.imagePaletteSwatch","background":"#627492","foreground":"#fff","population":0.01,"title":"#fff"},"vibrant":{"_type":"sanity.imagePaletteSwatch","background":"#3ca4ec","foreground":"#fff","population":0.01,"title":"#fff"}}},"mimeType":"image/png","originalFilename":"pastedImage0 (2).png","path":"images/hgftikht/production/7a13d480140db6abbf70eb41c80fbd7db91bdea2-1600x755.png","sha1hash":"7a13d480140db6abbf70eb41c80fbd7db91bdea2","size":97878,"uploadId":"q6F9qtHpSQJapMGkpauD9OvUIcKrdWyZ","url":"https://cdn.sanity.io/images/hgftikht/production/7a13d480140db6abbf70eb41c80fbd7db91bdea2-1600x755.png","id":"image-7a13d480140db6abbf70eb41c80fbd7db91bdea2-1600x755-png","parent":null,"children":["f9e66103-d02f-56a5-ab9b-9c5d39130e07"],"internal":{"type":"SanityImageAsset","contentDigest":"3afa16dc700b1c49ff2f876ff13f7db8","counter":2751,"owner":"gatsby-source-sanity"}}},{"_key":"f5cb8bd75388","_type":"block","children":[{"_key":"79fca18f6006","_type":"span","marks":[],"text":"In most cases, these segmentation tools have no context for the world outside the cluster, meaning they can block east/west attacks within the cluster, but aren’t able to do alot to stop connections outbound to supporting services like database. In some cases, they may have a black/whitelisting capability for the pods, but maintaining these rules in two locations is tedious and ineffective."}],"markDefs":[],"style":"normal"},{"_key":"3cc95e2eeab3","_type":"block","children":[{"_key":"bf00314c565d0","_type":"span","marks":["strong"],"text":"But I heard of this tool that works inside and outside the cluster?"}],"markDefs":[],"style":"normal"},{"_key":"fe2c9719d0ad","_type":"block","children":[{"_key":"a46fbeb64c950","_type":"span","marks":[],"text":"Some tools allow you to apply policies inside and outside of the cluster, but they work by installing agents on those virtual machines outside the cluster. This means that you can’t apply your segmentation policies to services like RDS which don’t give you access to the underlying host, and instead must run your own… "},{"_key":"a46fbeb64c951","_type":"span","marks":["em"],"text":"which defeats the whole point of being in the cloud in the first place."}],"markDefs":[],"style":"normal"},{"_key":"4291d6f524f6","_type":"block","children":[{"_key":"8af493bc6159","_type":"span","marks":["em"],"text":""}],"markDefs":[],"style":"normal"},{"_key":"c3d63e5ebe30","_type":"imageArticle","asset":{"_id":"image-a3e2f47fcd63cee0eb3823fe2f4823db799eb3c4-1433x688-png","_type":"sanity.imageAsset","_rev":"2jL4beAYAvILht20WpCJR5","_createdAt":"2020-09-17T17:55:58Z","_updatedAt":"2020-09-17T17:55:58Z","assetId":"a3e2f47fcd63cee0eb3823fe2f4823db799eb3c4","extension":"png","metadata":{"_type":"sanity.imageMetadata","dimensions":{"_type":"sanity.imageDimensions","aspectRatio":2.082848837209302,"height":688,"width":1433},"hasAlpha":false,"isOpaque":true,"lqip":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABc0lEQVQoz1WR22obMRCG9/0fpY/QFErpXQq5KDFN6kBtEmyyWu9qdZyj0tG6penwSULS/MPo14DpLBhVRfuQ97AyKrDS/+f/YmBMKtianRIrbtAV1AqSadO/R5u01rpYCAULQ6qQEDMTCAFD6WAhqiI9uyPMVKh4hqhM1sTAJWOcx4t7OE3nacF1pXnOh0N8/AnOcbUSYCJmFgBwL/7xNh3vOXolGignyHHv/Menafd8yW6C02m5/TZ9+lyORxNjzsUoBWIIv3YvXz64uxv0o7U8cM5U6xjyj9f12S1pXsrk4n4f73fonEBlAAJAI6V8PrjvX/3+jsIsiEO/rtX01crHWEIoYcXJsSnDKjlrKZ1abWa/wOsJL6OULNa2uaDM3WwWsbcRMaKmJPNClwsti8yzjKN632Js69q8V6tIm2HmeNtCN/f1ujd/7JHriiFICLx4K9dq7QDYbduyBhtvW9hyrdL32z/2pkTaH/RNN/7mW/wGS4VAm+xO7McAAAAASUVORK5CYII=","palette":{"_type":"sanity.imagePalette","darkMuted":{"_type":"sanity.imagePaletteSwatch","background":"#5d4246","foreground":"#fff","population":0.05,"title":"#fff"},"darkVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#b51f30","foreground":"#fff","population":0.15,"title":"#fff"},"dominant":{"_type":"sanity.imagePaletteSwatch","background":"#cca3a4","foreground":"#000","population":1.23,"title":"#fff"},"lightMuted":{"_type":"sanity.imagePaletteSwatch","background":"#cca3a4","foreground":"#000","population":1.23,"title":"#fff"},"lightVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#f8979c","foreground":"#000","population":0.17,"title":"#fff"},"muted":{"_type":"sanity.imagePaletteSwatch","background":"#5b8ba7","foreground":"#fff","population":0.03,"title":"#fff"},"vibrant":{"_type":"sanity.imagePaletteSwatch","background":"#ee7318","foreground":"#fff","population":0.06,"title":"#fff"}}},"mimeType":"image/png","originalFilename":"pasted image 0 (3).png","path":"images/hgftikht/production/a3e2f47fcd63cee0eb3823fe2f4823db799eb3c4-1433x688.png","sha1hash":"a3e2f47fcd63cee0eb3823fe2f4823db799eb3c4","size":54880,"uploadId":"fTbx75HrWZMvvBKmlt4iPLaRvHmSwAB3","url":"https://cdn.sanity.io/images/hgftikht/production/a3e2f47fcd63cee0eb3823fe2f4823db799eb3c4-1433x688.png","id":"image-a3e2f47fcd63cee0eb3823fe2f4823db799eb3c4-1433x688-png","parent":null,"children":["3cdcd43b-d903-56b3-89b5-df0cf504ee3b"],"internal":{"type":"SanityImageAsset","contentDigest":"ed3cb42294882ad3886d9e768444eacc","counter":2756,"owner":"gatsby-source-sanity"}}},{"_key":"7722dcb024b1","_type":"block","children":[{"_key":"c5a551867d69","_type":"span","marks":["strong"],"text":"So what about EKS?"}],"markDefs":[],"style":"normal"},{"_key":"28975b416b08","_type":"block","children":[{"_key":"fc627e550afb0","_type":"span","marks":[],"text":"One of the goals of AWS’s CNI is to be able to apply Security Groups to pods the same way as every other VPC resource. On release, we should be able to apply Security Groups for microsegmentation inside "},{"_key":"fc627e550afb1","_type":"span","marks":["em"],"text":"and"},{"_key":"fc627e550afb2","_type":"span","marks":[],"text":" outside of the cluster!"}],"markDefs":[],"style":"normal"},{"_key":"39b287d583e5","_type":"block","children":[{"_key":"226ebe836f50","_type":"span","marks":[],"text":""}],"markDefs":[],"style":"normal"},{"_key":"6badc8846257","_type":"imageArticle","asset":{"_id":"image-5a9416eb3f6aacadb79a91111eff50d48f682175-1600x851-png","_type":"sanity.imageAsset","_rev":"qD2nwhohCpR7vPHyE9dXau","_createdAt":"2020-09-17T17:58:11Z","_updatedAt":"2020-09-17T17:58:11Z","assetId":"5a9416eb3f6aacadb79a91111eff50d48f682175","extension":"png","metadata":{"_type":"sanity.imageMetadata","dimensions":{"_type":"sanity.imageDimensions","aspectRatio":1.8801410105757932,"height":851,"width":1600},"hasAlpha":false,"isOpaque":true,"lqip":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABgElEQVQoz21R22obMRDd//+F/oRpH0teivNUF1pI6rYLwZjE2bsue5Hmpu3sLiZx6eEgjc6ckQZNFvsCp5Y5SmJJ8p4sBBzof6kNGcFIOKKaBEjwSo1BxUjDmsJ/Uqw3a7EwMS8+FlxfoIVCnBbSItKbnlht2stiFs4QwPihcX2IURAFgPo+VhUYI4TzG5JSMU5T0XSd9VqYOTccntp9XpeVxa6DpvF5/vr5rjl8Q+/nWzDz07nafTnuf5ytG7Kutfe/iruHy/NLBXUNVWUeH0+7j5f9HqyZb59mxIffzx92h0/3edPabPT9S9meL40zjqdJOZZlezza0wmnSfuc35GJitf66/f855+zty7TMyESADNtVokRrSHvEsSZKCFICGuMCQC8G8pi7FoMIUtXXJtL+sdp6MVZ9o57z9ZAUVLbqJjGIXkn1kiYhDnTcal/W9MWKUAHPEzWTNaCc1A3uBWEsKwxiA5R56wfuDZ+A1W0wXEFxEgRdDDqog3rroV/AXL8eYuFnPs1AAAAAElFTkSuQmCC","palette":{"_type":"sanity.imagePalette","darkMuted":{"_type":"sanity.imagePaletteSwatch","background":"#504650","foreground":"#fff","population":0.12,"title":"#fff"},"darkVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#295d99","foreground":"#fff","population":0.1,"title":"#fff"},"dominant":{"_type":"sanity.imagePaletteSwatch","background":"#cdaaaa","foreground":"#000","population":1.3,"title":"#fff"},"lightMuted":{"_type":"sanity.imagePaletteSwatch","background":"#cdaaaa","foreground":"#000","population":1.3,"title":"#fff"},"lightVibrant":{"_type":"sanity.imagePaletteSwatch","background":"#ec7c9c","foreground":"#000","population":0,"title":"#fff"},"muted":{"_type":"sanity.imagePaletteSwatch","background":"#8d4c4f","foreground":"#fff","population":0.12,"title":"#fff"},"vibrant":{"_type":"sanity.imagePaletteSwatch","background":"#53acec","foreground":"#000","population":0.05,"title":"#fff"}}},"mimeType":"image/png","originalFilename":"pastedImage0 (4).png","path":"images/hgftikht/production/5a9416eb3f6aacadb79a91111eff50d48f682175-1600x851.png","sha1hash":"5a9416eb3f6aacadb79a91111eff50d48f682175","size":90184,"uploadId":"GSmofnFnFbo8tnvdOgpUovuA4rhDhqpF","url":"https://cdn.sanity.io/images/hgftikht/production/5a9416eb3f6aacadb79a91111eff50d48f682175-1600x851.png","id":"image-5a9416eb3f6aacadb79a91111eff50d48f682175-1600x851-png","parent":null,"children":["bd846230-5dee-5d04-843d-638f93e63374"],"internal":{"type":"SanityImageAsset","contentDigest":"2b1bb7911c28f4845100081d59f36dc2","counter":2760,"owner":"gatsby-source-sanity"}}},{"_key":"d87897f284a8","_type":"block","children":[{"_key":"540dd34588f2","_type":"span","marks":["strong"],"text":"When wouldn’t I use the AWS developed CNI?"}],"markDefs":[],"style":"h4"},{"_key":"866b61266ad6","_type":"block","children":[{"_key":"9aa9bee1d2850","_type":"span","marks":[],"text":"Virtual Machines in AWS have a max limit on the number of Elastic Network Interfaces that can be attached to any single vm at any time. This number varies by "},{"_key":"9aa9bee1d2851","_type":"span","marks":["cdfe69ad240f"],"text":"instance type"},{"_key":"9aa9bee1d2852","_type":"span","marks":[],"text":". This can be calculated as follows:"}],"markDefs":[{"_key":"cdfe69ad240f","_type":"link","href":"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html#AvailableIpPerENI"}],"style":"normal"},{"_key":"73cfe93bcc9f","_type":"block","children":[{"_key":"07f9b21ded170","_type":"span","marks":["strong"],"text":"ENIs x Secondary ips per ENI = Max Pods per Node"}],"markDefs":[],"style":"normal"},{"_key":"a42a382941b2","_type":"block","children":[{"_key":"15d6b134b4a60","_type":"span","marks":[],"text":"If the application you are building requires extremely high density of pods to nodes, you would be better off using one of the other CNI solutions like Calico or Weave, or perhaps something like Hashicorp’s Nomad which has been proven to scale up to one million containers across 5k hosts."}],"markDefs":[],"style":"normal"},{"_key":"2ad3cc01b598","_type":"block","children":[{"_key":"9b38925b7d5d0","_type":"span","marks":[],"text":"Another issue with the AWS CNI is its inefficient use of IP addresses. In order to attach an IP address to a Pod as quickly as possible, the CNI pre-loads a number of IPs to the Node. If the cluster is deployed in a particularly small VPC, you may run out of addresses, even if they aren’t being used by "},{"_key":"9b38925b7d5d1","_type":"span","marks":["em"],"text":"real"},{"_key":"9b38925b7d5d2","_type":"span","marks":[],"text":" workloads."}],"markDefs":[],"style":"normal"},{"_key":"036652121579","_type":"block","children":[{"_key":"81dd94daa1450","_type":"span","marks":["strong"],"text":"Final Thoughts"}],"markDefs":[],"style":"h4"},{"_key":"2b158379f358","_type":"block","children":[{"_key":"84f6801dced00","_type":"span","marks":[],"text":"For EKS to be a success in the AWS it needs to be properly integrated with the rest of the application ecosystem. By simplifying the network stack, the daunting barrier for entry in Kubernetes has been lowered, making it more accessible for new audiences, more secure for advanced audiences and better performance for those who need it."}],"markDefs":[],"style":"normal"},{"_key":"a28e23d7bf15","_type":"block","children":[{"_key":"7aec4c58e83d0","_type":"span","marks":[],"text":"I, for one, am really excited to see how this extends out into EKS Fargate and what happens when containers become a true compute primitive like EC2!"}],"markDefs":[],"style":"normal"},{"_key":"8f0d0ccbd1ae","_type":"block","children":[{"_key":"a1949cc855be0","_type":"span","marks":[],"text":"If you found this post interesting and would like to hear more, you can catch Rory at AWS Summit in Sydney on Wednesday 10 April at 10:45am giving a 15 minute talk on Secure Kubernetes in AWS.\n"}],"markDefs":[],"style":"normal"},{"_key":"75ca7247f56e","_type":"block","children":[{"_key":"71b4be6a9b950","_type":"span","marks":[],"text":"For a more indepth view of the Flannel Network Daemon, have a read of Xiao Han’s blog "},{"_key":"71b4be6a9b951","_type":"span","marks":["25ea824af28f"],"text":"here"},{"_key":"71b4be6a9b952","_type":"span","marks":[],"text":"."}],"level":1,"listItem":"bullet","markDefs":[{"_key":"25ea824af28f","_type":"link","href":"https://blog.laputa.io/kubernetes-flannel-networking-6a1cb1f8ec7c"}],"style":"normal"},{"_key":"7f00e17b7569","_type":"block","children":[{"_key":"c79db41e3d8c0","_type":"span","marks":[],"text":"Lyft already use a nearly identical approach to the AWS CNI. You can find more information "},{"_key":"c79db41e3d8c1","_type":"span","marks":["50527cf55ea8"],"text":"here"},{"_key":"c79db41e3d8c2","_type":"span","marks":[],"text":"."}],"level":1,"listItem":"bullet","markDefs":[{"_key":"50527cf55ea8","_type":"link","href":"https://github.com/lyft/cni-ipvlan-vpc-k8s"}],"style":"normal"}],"author":{"name":"Rory Chatterton","image":null}},"moreArticles":[{"title":"What Is OpenFaaS and How Can It Drive Innovation? An Interview with Creator Alex Ellis","slug":{"current":"what-is-openfaas-and-why-is-it-an-alternative-to-aws-lambda-an-interview-with-creator-alex-ellis"},"publishedAt":"19 March 2018","heroImage":{"alt":"What Is OpenFaaS and How Can It Drive Innovation? An Interview with Creator Alex Ellis","asset":{"fluid":{"aspectRatio":3.014354066985646,"src":"https://cdn.sanity.io/images/hgftikht/production/c59823cc8a42c39fe6363261b944bc6b2c84fff7-904x209.png?w=630&h=209&fit=crop","srcSet":"https://cdn.sanity.io/images/hgftikht/production/c59823cc8a42c39fe6363261b944bc6b2c84fff7-904x209.png?w=158&h=52&fit=crop 158w,\nhttps://cdn.sanity.io/images/hgftikht/production/c59823cc8a42c39fe6363261b944bc6b2c84fff7-904x209.png?w=315&h=105&fit=crop 315w,\nhttps://cdn.sanity.io/images/hgftikht/production/c59823cc8a42c39fe6363261b944bc6b2c84fff7-904x209.png?w=630&h=209&fit=crop 630w,\nhttps://cdn.sanity.io/images/hgftikht/production/c59823cc8a42c39fe6363261b944bc6b2c84fff7-904x209.png?w=904&h=300&fit=crop 904w","srcWebp":"https://cdn.sanity.io/images/hgftikht/production/c59823cc8a42c39fe6363261b944bc6b2c84fff7-904x209.png?w=630&h=209&fit=crop&fm=webp","srcSetWebp":"https://cdn.sanity.io/images/hgftikht/production/c59823cc8a42c39fe6363261b944bc6b2c84fff7-904x209.png?w=158&h=52&fit=crop&fm=webp 158w,\nhttps://cdn.sanity.io/images/hgftikht/production/c59823cc8a42c39fe6363261b944bc6b2c84fff7-904x209.png?w=315&h=105&fit=crop&fm=webp 315w,\nhttps://cdn.sanity.io/images/hgftikht/production/c59823cc8a42c39fe6363261b944bc6b2c84fff7-904x209.png?w=630&h=209&fit=crop&fm=webp 630w,\nhttps://cdn.sanity.io/images/hgftikht/production/c59823cc8a42c39fe6363261b944bc6b2c84fff7-904x209.png?w=904&h=300&fit=crop&fm=webp 904w","sizes":"(max-width: 630px) 100vw, 630px"}}},"author":{"name":"Ben Tannahill","image":null}},{"title":"The Current State of Digital Transformation in Australia Revealed","slug":{"current":"the-current-state-of-digital-transformation-in-australia-revealed"},"publishedAt":"16 March 2018","heroImage":{"alt":"The Current State of Digital Transformation in Australia Revealed","asset":{"fluid":{"aspectRatio":1.4754098360655739,"src":"https://cdn.sanity.io/images/hgftikht/production/6afa456c58d518377b2ebd62698842c212e8660c-1200x804.png?w=630&h=427&fit=crop","srcSet":"https://cdn.sanity.io/images/hgftikht/production/6afa456c58d518377b2ebd62698842c212e8660c-1200x804.png?w=158&h=107&fit=crop 158w,\nhttps://cdn.sanity.io/images/hgftikht/production/6afa456c58d518377b2ebd62698842c212e8660c-1200x804.png?w=315&h=214&fit=crop 315w,\nhttps://cdn.sanity.io/images/hgftikht/production/6afa456c58d518377b2ebd62698842c212e8660c-1200x804.png?w=630&h=427&fit=crop 630w,\nhttps://cdn.sanity.io/images/hgftikht/production/6afa456c58d518377b2ebd62698842c212e8660c-1200x804.png?w=945&h=641&fit=crop 945w,\nhttps://cdn.sanity.io/images/hgftikht/production/6afa456c58d518377b2ebd62698842c212e8660c-1200x804.png?w=1200&h=813&fit=crop 1200w","srcWebp":"https://cdn.sanity.io/images/hgftikht/production/6afa456c58d518377b2ebd62698842c212e8660c-1200x804.png?w=630&h=427&fit=crop&fm=webp","srcSetWebp":"https://cdn.sanity.io/images/hgftikht/production/6afa456c58d518377b2ebd62698842c212e8660c-1200x804.png?w=158&h=107&fit=crop&fm=webp 158w,\nhttps://cdn.sanity.io/images/hgftikht/production/6afa456c58d518377b2ebd62698842c212e8660c-1200x804.png?w=315&h=214&fit=crop&fm=webp 315w,\nhttps://cdn.sanity.io/images/hgftikht/production/6afa456c58d518377b2ebd62698842c212e8660c-1200x804.png?w=630&h=427&fit=crop&fm=webp 630w,\nhttps://cdn.sanity.io/images/hgftikht/production/6afa456c58d518377b2ebd62698842c212e8660c-1200x804.png?w=945&h=641&fit=crop&fm=webp 945w,\nhttps://cdn.sanity.io/images/hgftikht/production/6afa456c58d518377b2ebd62698842c212e8660c-1200x804.png?w=1200&h=813&fit=crop&fm=webp 1200w","sizes":"(max-width: 630px) 100vw, 630px"}}},"author":{"name":"Andrew Brydon","image":null}},{"title":"Digital Transformation Is an Opportunity to Focus on the Customer: An Interview with Jatil Damania","slug":{"current":"an-interview-with-jatil-damania"},"publishedAt":"7 March 2018","heroImage":{"alt":"Digital Transformation Is an Opportunity to Focus on the Customer: An Interview with Jatil Damania","asset":{"fluid":{"aspectRatio":1.4754098360655739,"src":"https://cdn.sanity.io/images/hgftikht/production/f3051e4850f3be4c0eabeb8fb201bbe77d023542-848x471.jpg?w=630&h=427&fit=crop","srcSet":"https://cdn.sanity.io/images/hgftikht/production/f3051e4850f3be4c0eabeb8fb201bbe77d023542-848x471.jpg?w=158&h=107&fit=crop 158w,\nhttps://cdn.sanity.io/images/hgftikht/production/f3051e4850f3be4c0eabeb8fb201bbe77d023542-848x471.jpg?w=315&h=214&fit=crop 315w,\nhttps://cdn.sanity.io/images/hgftikht/production/f3051e4850f3be4c0eabeb8fb201bbe77d023542-848x471.jpg?w=630&h=427&fit=crop 630w,\nhttps://cdn.sanity.io/images/hgftikht/production/f3051e4850f3be4c0eabeb8fb201bbe77d023542-848x471.jpg?w=848&h=575&fit=crop 848w","srcWebp":"https://cdn.sanity.io/images/hgftikht/production/f3051e4850f3be4c0eabeb8fb201bbe77d023542-848x471.jpg?w=630&h=427&fit=crop&fm=webp","srcSetWebp":"https://cdn.sanity.io/images/hgftikht/production/f3051e4850f3be4c0eabeb8fb201bbe77d023542-848x471.jpg?w=158&h=107&fit=crop&fm=webp 158w,\nhttps://cdn.sanity.io/images/hgftikht/production/f3051e4850f3be4c0eabeb8fb201bbe77d023542-848x471.jpg?w=315&h=214&fit=crop&fm=webp 315w,\nhttps://cdn.sanity.io/images/hgftikht/production/f3051e4850f3be4c0eabeb8fb201bbe77d023542-848x471.jpg?w=630&h=427&fit=crop&fm=webp 630w,\nhttps://cdn.sanity.io/images/hgftikht/production/f3051e4850f3be4c0eabeb8fb201bbe77d023542-848x471.jpg?w=848&h=575&fit=crop&fm=webp 848w","sizes":"(max-width: 630px) 100vw, 630px"}}},"author":{"name":"Brian Guerra","image":null}}],"sanityPage":{"slug":{"current":"insights"},"blocks":[{"__typename":"SanitySignupBlock","_key":"bcb83330a70e","_type":"signupBlock","component":"module---src-components-blocks-signup-block-index-js-default-","reference":{"title":"Sign-up: Insights Directly to Your Inbox","subtitle":"Join tens of thousands of your peers and sign-up for our best content and industry commentary, curated by our experts.","successMessage":"Thanks for signing-up!","submitBtn":"Subscribe","marketoSnippet":"<script src=\"https://www10.contino.io/js/forms2/js/forms2.min.js\"></script><form id=\"mktoForm_1126\"></form>   <script>    MktoForms2.setOptions({formXDPath : \"/rs/964-BIK-421/images/marketo-xdframe-relative.html\"});    MktoForms2.loadForm(\"//www10.contino.io\", \"964-BIK-421\", 1126);   </script>"}}]}},"pageContext":{"sanityId":"4813d3be-fef0-4d71-8511-bd41ee9c7559"}},"staticQueryHashes":["2919194494","3157258374","3449559901"],"moduleDependencies":["module---src-components-blocks-signup-block-index-js-default-"]}